{"version":3,"kind":"Notebook","sha256":"b669234f7d98befb0757dd1e478b2418fc2ecd948b018560d89a4d47eadbbadf","slug":"joan","location":"/notebooks/Amanda/joan.ipynb","dependencies":[],"frontmatter":{"title":"Seisbench (detections the easy way)","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"pytorch","language":"python"},"authors":[{"id":"Amanda M. Thomas, William Marfo, and Loïc Bachelot","name":"Amanda M. Thomas, William Marfo, and Loïc Bachelot"}],"keywords":["earthquake","catalog","ML","AI"],"numbering":{"title":{"offset":2}},"thumbnail":"/050bd234c7374c32150e7c7359aec606.svg","exports":[{"format":"ipynb","filename":"joan.ipynb","url":"/joan-8c4d3da18024dea1a1837050fa0fb3a1.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{"id":"679a2782","pycharm":{"name":"#%% md\n"}},"children":[{"type":"image","url":"/050bd234c7374c32150e7c7359aec606.svg","alt":"image","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"RLTym51Cwd","urlSource":"https://raw.githubusercontent.com/seisbench/seisbench/main/docs/_static/seisbench_logo_subtitle_outlined.svg"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Author:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"UHlPn2L5VZ"}],"key":"u1g1IpZQKo"},{"type":"text","value":" Amanda M. Thomas (modified from Seisbench colab notebook for Ferndale)\n","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"wNjtBDzgT1"},{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Goal:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"nCfVMt9VeD"}],"key":"rV8af02afd"},{"type":"text","value":" A quick Seisbench demonstration.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Oe4CSVz33R"}],"key":"wvI4tjtgQJ"}],"identifier":"679a2782","label":"679a2782","html_id":"id-679a2782","key":"ZxXu9uwYOJ"},{"type":"block","kind":"notebook-code","data":{"ExecuteTime":{"end_time":"2023-08-14T19:48:28.892368Z","start_time":"2023-08-14T19:48:27.814671Z"},"id":"f2ad2b47","pycharm":{"name":"#%%\n"}},"children":[{"type":"code","lang":"python","executable":true,"value":"import seisbench\nimport seisbench.models as sbm","identifier":"f2ad2b47-code","enumerator":"1","html_id":"f2ad2b47-code","key":"PrQoGc79Gu"},{"type":"outputs","id":"JO3NYMn1LE8tX54_mqTZo","children":[],"identifier":"f2ad2b47-outputs","html_id":"f2ad2b47-outputs","key":"xaUwFi1K6F"}],"identifier":"f2ad2b47","label":"f2ad2b47","html_id":"f2ad2b47","key":"hfsZYS9jYH"},{"type":"block","kind":"notebook-content","data":{"id":"df9e9d86","pycharm":{"name":"#%% md\n"}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Creating a model","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vms7vieJPG"}],"identifier":"creating-a-model","label":"Creating a model","html_id":"creating-a-model","implicit":true,"key":"cWaTAqmTsF"}],"identifier":"df9e9d86","label":"df9e9d86","html_id":"df9e9d86","key":"gArRhO7Toa"},{"type":"block","kind":"notebook-content","data":{"id":"6f61e723","pycharm":{"name":"#%% md\n"}},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Here you can download your pretrained model for predicting on the example streams.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Dp7RqNk3DW"}],"identifier":"here-you-can-download-your-pretrained-model-for-predicting-on-the-example-streams","label":"Here you can download your pretrained model for predicting on the example streams.","html_id":"here-you-can-download-your-pretrained-model-for-predicting-on-the-example-streams","implicit":true,"key":"iZdcwIzGVF"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"if you would like to see the full suite of available pre-trained weights for any model, you can call the ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"p2AfAluHzo"},{"type":"inlineCode","value":"list_pretrained","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"MuGmeVuti6"},{"type":"text","value":" method, which will return all the associated weights for the model, along with information on the training procedure for each set of weights. For the purposes of this plug-in-and-play example, we comment out a number of available models, for you to load and try out.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"ZvAB8gW9TF"}],"key":"czjnx3oQ21"}],"identifier":"6f61e723","label":"6f61e723","html_id":"id-6f61e723","key":"XUY9e1lI0h"},{"type":"block","kind":"notebook-code","data":{"ExecuteTime":{"end_time":"2023-08-14T19:48:29.580648Z","start_time":"2023-08-14T19:48:29.462859Z"},"id":"4e34Nh1TTFsq","pycharm":{"name":"#%%\n"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Various pre-trained weights for PhaseNet\n# pn_model = sbm.PhaseNet.from_pretrained(\"ethz\")\n# pn_model = sbm.PhaseNet.from_pretrained(\"instance\")\n# pn_model = sbm.PhaseNet.from_pretrained(\"scedc\")\npn_model = sbm.PhaseNet.from_pretrained(\"stead\")\n# pn_model = sbm.PhaseNet.from_pretrained(\"geofon\")\n# pn_model = sbm.PhaseNet.from_pretrained(\"neic\")\n\n# Various pre-trained weights for EQT\n# eqt_model = sbm.EQTransformer.from_pretrained(\"original\")\n# eqt_model = sbm.EQTransformer.from_pretrained(\"ethz\")\n# eqt_model = sbm.EQTransformer.from_pretrained(\"instance\")\n# eqt_model = sbm.EQTransformer.from_pretrained(\"scedc\")\n# eqt_model = sbm.EQTransformer.from_pretrained(\"stead\")\n# eqt_model = sbm.EQTransformer.from_pretrained(\"geofon\")\n\n# Various pre-trained weights for GPD\n# gpd_model = sbm.GPD.from_pretrained(\"original\")\n# gpd_model = sbm.GPD.from_pretrained(\"ethz\")\n# gpd_model = sbm.GPD.from_pretrained(\"scedc\")\n# gpd_model = sbm.GPD.from_pretrained(\"stead\")\n# gpd_model = sbm.GPD.from_pretrained(\"geofon\")\n# gpd_model = sbm.GPD.from_pretrained(\"neic\")","identifier":"4e34nh1ttfsq-code","enumerator":"2","html_id":"id-4e34nh1ttfsq-code","key":"uTDnm6M3Dz"},{"type":"outputs","id":"yHm0NCXCL9-SOJDUt6_Kx","children":[],"identifier":"4e34nh1ttfsq-outputs","html_id":"id-4e34nh1ttfsq-outputs","key":"xfoJzRHttd"}],"identifier":"4e34nh1ttfsq","label":"4e34Nh1TTFsq","html_id":"id-4e34nh1ttfsq","key":"fJLPYDaEMM"},{"type":"block","kind":"notebook-content","data":{"id":"jWCjFmtHTOGC","pycharm":{"name":"#%% md\n"}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Read in waveforms","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zsBo8XYhWe"}],"identifier":"read-in-waveforms","label":"Read in waveforms","html_id":"read-in-waveforms","implicit":true,"key":"fr4q7uurEK"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"This waveform example contains part of the 2009 L’Acquila earthquake sequence occuring in the Abruzzo region of central Italy. The Mw 6.4 mainshock is located ~2 minutes into the seismic recording, with many afterhshocks occuring directly after. The seismic trace loaded in from obspy spans the ~1 hour period immediately following the mainshock.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"SNknRmClN8"}],"key":"n5BIsHOfT2"}],"identifier":"jwcjfmthtogc","label":"jWCjFmtHTOGC","html_id":"jwcjfmthtogc","key":"uIGsVKqFY4"},{"type":"block","kind":"notebook-code","data":{"ExecuteTime":{"end_time":"2023-08-14T19:48:38.203475Z","start_time":"2023-08-14T19:48:32.214108Z"},"colab":{"base_uri":"https://localhost:8080/","height":331},"id":"pvK617WcNZRx","outputId":"bfe423c9-8b79-4a06-f1e7-fd8e71929783","pycharm":{"name":"#%%\n"}},"children":[{"type":"code","lang":"python","executable":true,"value":"\nfrom obspy.clients.fdsn import Client\nfrom obspy import UTCDateTime\nimport matplotlib.pyplot as plt\nimport obspy as obs\nimport numpy as np\nimport matplotlib.pyplot as plt\n\n# Load the data\nstream = obs.read('../data/B047*')\n\n# Detrend the data\nstream.detrend(\"linear\")","identifier":"pvk617wcnzrx-code","enumerator":"3","html_id":"pvk617wcnzrx-code","key":"FFpcBR08KP"},{"type":"outputs","id":"jJNAsE-1BZVLtx863PtNG","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"text/plain":{"content":"3 Trace(s) in Stream:\nPB.B047..EH1 | 2022-12-20T00:00:00.008400Z - 2022-12-20T23:59:59.998400Z | 100.0 Hz, 8640000 samples\nPB.B047..EH2 | 2022-12-20T00:00:00.008400Z - 2022-12-20T23:59:59.998400Z | 100.0 Hz, 8640000 samples\nPB.B047..EHZ | 2022-12-20T00:00:00.008400Z - 2022-12-20T23:59:59.998400Z | 100.0 Hz, 8640000 samples","content_type":"text/plain"}}},"children":[],"identifier":"pvk617wcnzrx-outputs-0","html_id":"pvk617wcnzrx-outputs-0","key":"zBp6eeUxjN"}],"identifier":"pvk617wcnzrx-outputs","html_id":"pvk617wcnzrx-outputs","key":"Yboj50z0TF"}],"identifier":"pvk617wcnzrx","label":"pvK617WcNZRx","html_id":"pvk617wcnzrx","key":"O4jWB7ef1G"},{"type":"block","kind":"notebook-content","data":{"id":"oholMBLyTRw1","pycharm":{"name":"#%% md\n"}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Predict model on seismic stream","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qINesBxGR1"}],"identifier":"predict-model-on-seismic-stream","label":"Predict model on seismic stream","html_id":"predict-model-on-seismic-stream","implicit":true,"key":"z1M2YX2Cx1"}],"identifier":"oholmblytrw1","label":"oholMBLyTRw1","html_id":"oholmblytrw1","key":"G0YeC4RdPQ"},{"type":"block","kind":"notebook-content","data":{"id":"yi_krX7Q4vU_","pycharm":{"name":"#%% md\n"}},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We can apply our varying models now to the seismic stream through the high level ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sg4trwfFF7"},{"type":"inlineCode","value":"annotate","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"khw48EaFHb"},{"type":"text","value":" method. This will output the charactersitic functions for the probability of a P-phase, S-phase, and noise class respectively.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dkDYberwDV"}],"key":"abxsTRDdHe"}],"identifier":"yi_krx7q4vu_","label":"yi_krX7Q4vU_","html_id":"yi-krx7q4vu","key":"zrOrgHHWi6"},{"type":"block","kind":"notebook-code","data":{"ExecuteTime":{"end_time":"2023-08-14T19:48:47.808135Z","start_time":"2023-08-14T19:48:38.205050Z"},"colab":{"base_uri":"https://localhost:8080/"},"id":"lj_W0_LcQKyO","outputId":"992799ba-1d68-47fd-8312-d1e957a3a9e5","pycharm":{"name":"#%%\n"}},"children":[{"type":"code","lang":"python","executable":true,"value":"pn_preds = pn_model.annotate(stream)\n\npn_preds","identifier":"lj_w0_lcqkyo-code","enumerator":"4","html_id":"lj-w0-lcqkyo-code","key":"sDkEVyzSSh"},{"type":"outputs","id":"onr6LI4fl2kcCj4uomtru","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"text/plain":{"content":"3 Trace(s) in Stream:\nPB.B047..PhaseNet_P | 2022-12-20T00:00:02.510000Z - 2022-12-20T23:59:57.500000Z | 100.0 Hz, 8639500 samples\nPB.B047..PhaseNet_S | 2022-12-20T00:00:02.510000Z - 2022-12-20T23:59:57.500000Z | 100.0 Hz, 8639500 samples\nPB.B047..PhaseNet_N | 2022-12-20T00:00:02.510000Z - 2022-12-20T23:59:57.500000Z | 100.0 Hz, 8639500 samples","content_type":"text/plain"}}},"children":[],"identifier":"lj_w0_lcqkyo-outputs-0","html_id":"lj-w0-lcqkyo-outputs-0","key":"YOCrTp0qe8"}],"identifier":"lj_w0_lcqkyo-outputs","html_id":"lj-w0-lcqkyo-outputs","key":"X0wAgGreNy"}],"identifier":"lj_w0_lcqkyo","label":"lj_W0_LcQKyO","html_id":"lj-w0-lcqkyo","key":"MePCFsNpGe"},{"type":"block","kind":"notebook-content","data":{"id":"vATAaDohTYwj","pycharm":{"name":"#%% md\n"}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Step through to ‘zoom in’ on predictions","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kfaQjkLu5c"}],"identifier":"step-through-to-zoom-in-on-predictions","label":"Step through to ‘zoom in’ on predictions","html_id":"step-through-to-zoom-in-on-predictions","implicit":true,"key":"e5q15Epd7Q"}],"identifier":"vataadohtywj","label":"vATAaDohTYwj","html_id":"vataadohtywj","key":"ii4V0Y87o4"},{"type":"block","kind":"notebook-content","data":{"id":"XQzmBfSv5wUn","pycharm":{"name":"#%% md\n"}},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Enter window length in seconds, and define which model predictions you would like to plot","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UN6N4MBdoI"}],"key":"o7dejhOTur"}],"identifier":"xqzmbfsv5wun","label":"XQzmBfSv5wUn","html_id":"xqzmbfsv5wun","key":"S7wtiavrsd"},{"type":"block","kind":"notebook-code","data":{"ExecuteTime":{"end_time":"2023-08-14T19:48:47.811243Z","start_time":"2023-08-14T19:48:47.809587Z"},"cellView":"form","id":"T8Ce2LYe5oVu","pycharm":{"name":"#%%\n"}},"children":[{"type":"code","lang":"python","executable":true,"value":"wlength = 3 * 60 #@param","identifier":"t8ce2lye5ovu-code","enumerator":"5","html_id":"t8ce2lye5ovu-code","key":"FXppAuxK9M"},{"type":"outputs","id":"7Z2rC6cz7clTaRJICetcJ","children":[],"identifier":"t8ce2lye5ovu-outputs","html_id":"t8ce2lye5ovu-outputs","key":"BL1f6Y3zmn"}],"identifier":"t8ce2lye5ovu","label":"T8Ce2LYe5oVu","html_id":"t8ce2lye5ovu","key":"VUQVcDbS51"},{"type":"block","kind":"notebook-code","data":{"ExecuteTime":{"end_time":"2023-08-14T19:48:51.391411Z","start_time":"2023-08-14T19:48:47.812451Z"},"colab":{"base_uri":"https://localhost:8080/","height":1000},"id":"tZSXpHELQ6QB","outputId":"78b62541-7ab9-4bb1-a9a4-f1cf0404193a","pycharm":{"name":"#%%\n"},"scrolled":false},"children":[{"type":"code","lang":"python","executable":true,"value":"color_dict = {\"P\": \"C0\", \"S\": \"C1\", \"Detection\": \"C2\"}\n\nfor s in range(0, int(stream[0].stats.endtime - stream[0].stats.starttime), wlength):\n    t0 = stream[0].stats.starttime + s\n    t1 = t0 + wlength\n    subst = stream.copy().slice(t0, t1)\n\n    fig, ax = plt.subplots(2, 1, figsize=(15, 7), sharex=True, gridspec_kw={'hspace' : 0.05, 'height_ratios': [2, 1]})\n\n    for i, preds in enumerate([pn_preds]):\n        subpreds = preds.slice(t0, t1)\n        offset = subpreds[0].stats.starttime - subst[0].stats.starttime\n        for pred_trace in subpreds:\n            model, pred_class = pred_trace.stats.channel.split(\"_\")\n            if pred_class == \"N\":\n                # Skip noise traces\n                continue\n            c = color_dict[pred_class]\n            ax[i + 1].plot(offset + pred_trace.times(), pred_trace.data, label=pred_class, c=c)\n        ax[i + 1].set_ylabel(model)\n        ax[i + 1].legend(loc=2)\n        ax[i + 1].set_ylim(0, 1.1)\n\n    ax[0].plot(subst[-1].times(), subst[-1].data / np.amax(subst[-1].data), 'k', label=subst[-1].stats.channel)\n    ax[0].set_xlim(0, wlength)\n    ax[0].set_ylabel('Normalised Amplitude')\n    ax[3].set_xlabel('Time [s]')\n    ax[0].legend(loc=2)\n    plt.show()","identifier":"tzsxphelq6qb-code","enumerator":"6","html_id":"tzsxphelq6qb-code","key":"be02AT2zx1"},{"type":"outputs","id":"dXHoESzBNSRWdjDrAE9Hh","children":[{"type":"output","jupyter_data":{"ename":"ValueError","evalue":"Expected the given number of height ratios to match the number of rows of the grid","output_type":"error","traceback":"\u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mValueError\u001b[39m                                Traceback (most recent call last)\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[10]\u001b[39m\u001b[32m, line 8\u001b[39m\n\u001b[32m      5\u001b[39m t1 = t0 + wlength\n\u001b[32m      6\u001b[39m subst = stream.copy().slice(t0, t1)\n\u001b[32m----> \u001b[39m\u001b[32m8\u001b[39m fig, ax = \u001b[43mplt\u001b[49m\u001b[43m.\u001b[49m\u001b[43msubplots\u001b[49m\u001b[43m(\u001b[49m\u001b[32;43m2\u001b[39;49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[32;43m1\u001b[39;49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mfigsize\u001b[49m\u001b[43m=\u001b[49m\u001b[43m(\u001b[49m\u001b[32;43m15\u001b[39;49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[32;43m7\u001b[39;49m\u001b[43m)\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43msharex\u001b[49m\u001b[43m=\u001b[49m\u001b[38;5;28;43;01mTrue\u001b[39;49;00m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mgridspec_kw\u001b[49m\u001b[43m=\u001b[49m\u001b[43m{\u001b[49m\u001b[33;43m'\u001b[39;49m\u001b[33;43mhspace\u001b[39;49m\u001b[33;43m'\u001b[39;49m\u001b[43m \u001b[49m\u001b[43m:\u001b[49m\u001b[43m \u001b[49m\u001b[32;43m0.05\u001b[39;49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[33;43m'\u001b[39;49m\u001b[33;43mheight_ratios\u001b[39;49m\u001b[33;43m'\u001b[39;49m\u001b[43m:\u001b[49m\u001b[43m \u001b[49m\u001b[43m[\u001b[49m\u001b[32;43m2\u001b[39;49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[32;43m1\u001b[39;49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[32;43m1\u001b[39;49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[32;43m1\u001b[39;49m\u001b[43m]\u001b[49m\u001b[43m}\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m     10\u001b[39m \u001b[38;5;28;01mfor\u001b[39;00m i, preds \u001b[38;5;129;01min\u001b[39;00m \u001b[38;5;28menumerate\u001b[39m([pn_preds]):\n\u001b[32m     11\u001b[39m     subpreds = preds.slice(t0, t1)\n\n\u001b[36mFile \u001b[39m\u001b[32m~/anaconda3/envs/pytorch/lib/python3.12/site-packages/matplotlib/pyplot.py:1770\u001b[39m, in \u001b[36msubplots\u001b[39m\u001b[34m(nrows, ncols, sharex, sharey, squeeze, width_ratios, height_ratios, subplot_kw, gridspec_kw, **fig_kw)\u001b[39m\n\u001b[32m   1625\u001b[39m \u001b[38;5;250m\u001b[39m\u001b[33;03m\"\"\"\u001b[39;00m\n\u001b[32m   1626\u001b[39m \u001b[33;03mCreate a figure and a set of subplots.\u001b[39;00m\n\u001b[32m   1627\u001b[39m \n\u001b[32m   (...)\u001b[39m\u001b[32m   1767\u001b[39m \n\u001b[32m   1768\u001b[39m \u001b[33;03m\"\"\"\u001b[39;00m\n\u001b[32m   1769\u001b[39m fig = figure(**fig_kw)\n\u001b[32m-> \u001b[39m\u001b[32m1770\u001b[39m axs = \u001b[43mfig\u001b[49m\u001b[43m.\u001b[49m\u001b[43msubplots\u001b[49m\u001b[43m(\u001b[49m\u001b[43mnrows\u001b[49m\u001b[43m=\u001b[49m\u001b[43mnrows\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mncols\u001b[49m\u001b[43m=\u001b[49m\u001b[43mncols\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43msharex\u001b[49m\u001b[43m=\u001b[49m\u001b[43msharex\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43msharey\u001b[49m\u001b[43m=\u001b[49m\u001b[43msharey\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m   1771\u001b[39m \u001b[43m                   \u001b[49m\u001b[43msqueeze\u001b[49m\u001b[43m=\u001b[49m\u001b[43msqueeze\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43msubplot_kw\u001b[49m\u001b[43m=\u001b[49m\u001b[43msubplot_kw\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m   1772\u001b[39m \u001b[43m                   \u001b[49m\u001b[43mgridspec_kw\u001b[49m\u001b[43m=\u001b[49m\u001b[43mgridspec_kw\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mheight_ratios\u001b[49m\u001b[43m=\u001b[49m\u001b[43mheight_ratios\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m   1773\u001b[39m \u001b[43m                   \u001b[49m\u001b[43mwidth_ratios\u001b[49m\u001b[43m=\u001b[49m\u001b[43mwidth_ratios\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m   1774\u001b[39m \u001b[38;5;28;01mreturn\u001b[39;00m fig, axs\n\n\u001b[36mFile \u001b[39m\u001b[32m~/anaconda3/envs/pytorch/lib/python3.12/site-packages/matplotlib/figure.py:918\u001b[39m, in \u001b[36mFigureBase.subplots\u001b[39m\u001b[34m(self, nrows, ncols, sharex, sharey, squeeze, width_ratios, height_ratios, subplot_kw, gridspec_kw)\u001b[39m\n\u001b[32m    914\u001b[39m         \u001b[38;5;28;01mraise\u001b[39;00m \u001b[38;5;167;01mValueError\u001b[39;00m(\u001b[33m\"\u001b[39m\u001b[33m'\u001b[39m\u001b[33mwidth_ratios\u001b[39m\u001b[33m'\u001b[39m\u001b[33m must not be defined both as \u001b[39m\u001b[33m\"\u001b[39m\n\u001b[32m    915\u001b[39m                          \u001b[33m\"\u001b[39m\u001b[33mparameter and as key in \u001b[39m\u001b[33m'\u001b[39m\u001b[33mgridspec_kw\u001b[39m\u001b[33m'\u001b[39m\u001b[33m\"\u001b[39m)\n\u001b[32m    916\u001b[39m     gridspec_kw[\u001b[33m'\u001b[39m\u001b[33mwidth_ratios\u001b[39m\u001b[33m'\u001b[39m] = width_ratios\n\u001b[32m--> \u001b[39m\u001b[32m918\u001b[39m gs = \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43madd_gridspec\u001b[49m\u001b[43m(\u001b[49m\u001b[43mnrows\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mncols\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mfigure\u001b[49m\u001b[43m=\u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43m*\u001b[49m\u001b[43m*\u001b[49m\u001b[43mgridspec_kw\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    919\u001b[39m axs = gs.subplots(sharex=sharex, sharey=sharey, squeeze=squeeze,\n\u001b[32m    920\u001b[39m                   subplot_kw=subplot_kw)\n\u001b[32m    921\u001b[39m \u001b[38;5;28;01mreturn\u001b[39;00m axs\n\n\u001b[36mFile \u001b[39m\u001b[32m~/anaconda3/envs/pytorch/lib/python3.12/site-packages/matplotlib/figure.py:1600\u001b[39m, in \u001b[36mFigureBase.add_gridspec\u001b[39m\u001b[34m(self, nrows, ncols, **kwargs)\u001b[39m\n\u001b[32m   1557\u001b[39m \u001b[38;5;250m\u001b[39m\u001b[33;03m\"\"\"\u001b[39;00m\n\u001b[32m   1558\u001b[39m \u001b[33;03mLow-level API for creating a `.GridSpec` that has this figure as a parent.\u001b[39;00m\n\u001b[32m   1559\u001b[39m \n\u001b[32m   (...)\u001b[39m\u001b[32m   1596\u001b[39m \n\u001b[32m   1597\u001b[39m \u001b[33;03m\"\"\"\u001b[39;00m\n\u001b[32m   1599\u001b[39m _ = kwargs.pop(\u001b[33m'\u001b[39m\u001b[33mfigure\u001b[39m\u001b[33m'\u001b[39m, \u001b[38;5;28;01mNone\u001b[39;00m)  \u001b[38;5;66;03m# pop in case user has added this...\u001b[39;00m\n\u001b[32m-> \u001b[39m\u001b[32m1600\u001b[39m gs = \u001b[43mGridSpec\u001b[49m\u001b[43m(\u001b[49m\u001b[43mnrows\u001b[49m\u001b[43m=\u001b[49m\u001b[43mnrows\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mncols\u001b[49m\u001b[43m=\u001b[49m\u001b[43mncols\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mfigure\u001b[49m\u001b[43m=\u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43m*\u001b[49m\u001b[43m*\u001b[49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m   1601\u001b[39m \u001b[38;5;28;01mreturn\u001b[39;00m gs\n\n\u001b[36mFile \u001b[39m\u001b[32m~/anaconda3/envs/pytorch/lib/python3.12/site-packages/matplotlib/gridspec.py:363\u001b[39m, in \u001b[36mGridSpec.__init__\u001b[39m\u001b[34m(self, nrows, ncols, figure, left, bottom, right, top, wspace, hspace, width_ratios, height_ratios)\u001b[39m\n\u001b[32m    360\u001b[39m \u001b[38;5;28mself\u001b[39m.hspace = hspace\n\u001b[32m    361\u001b[39m \u001b[38;5;28mself\u001b[39m.figure = figure\n\u001b[32m--> \u001b[39m\u001b[32m363\u001b[39m \u001b[38;5;28;43msuper\u001b[39;49m\u001b[43m(\u001b[49m\u001b[43m)\u001b[49m\u001b[43m.\u001b[49m\u001b[34;43m__init__\u001b[39;49m\u001b[43m(\u001b[49m\u001b[43mnrows\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mncols\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    364\u001b[39m \u001b[43m                 \u001b[49m\u001b[43mwidth_ratios\u001b[49m\u001b[43m=\u001b[49m\u001b[43mwidth_ratios\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    365\u001b[39m \u001b[43m                 \u001b[49m\u001b[43mheight_ratios\u001b[49m\u001b[43m=\u001b[49m\u001b[43mheight_ratios\u001b[49m\u001b[43m)\u001b[49m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/anaconda3/envs/pytorch/lib/python3.12/site-packages/matplotlib/gridspec.py:54\u001b[39m, in \u001b[36mGridSpecBase.__init__\u001b[39m\u001b[34m(self, nrows, ncols, height_ratios, width_ratios)\u001b[39m\n\u001b[32m     51\u001b[39m     \u001b[38;5;28;01mraise\u001b[39;00m \u001b[38;5;167;01mValueError\u001b[39;00m(\n\u001b[32m     52\u001b[39m         \u001b[33mf\u001b[39m\u001b[33m\"\u001b[39m\u001b[33mNumber of columns must be a positive integer, not \u001b[39m\u001b[38;5;132;01m{\u001b[39;00mncols\u001b[38;5;132;01m!r}\u001b[39;00m\u001b[33m\"\u001b[39m)\n\u001b[32m     53\u001b[39m \u001b[38;5;28mself\u001b[39m._nrows, \u001b[38;5;28mself\u001b[39m._ncols = nrows, ncols\n\u001b[32m---> \u001b[39m\u001b[32m54\u001b[39m \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mset_height_ratios\u001b[49m\u001b[43m(\u001b[49m\u001b[43mheight_ratios\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m     55\u001b[39m \u001b[38;5;28mself\u001b[39m.set_width_ratios(width_ratios)\n\n\u001b[36mFile \u001b[39m\u001b[32m~/anaconda3/envs/pytorch/lib/python3.12/site-packages/matplotlib/gridspec.py:132\u001b[39m, in \u001b[36mGridSpecBase.set_height_ratios\u001b[39m\u001b[34m(self, height_ratios)\u001b[39m\n\u001b[32m    130\u001b[39m     height_ratios = [\u001b[32m1\u001b[39m] * \u001b[38;5;28mself\u001b[39m._nrows\n\u001b[32m    131\u001b[39m \u001b[38;5;28;01melif\u001b[39;00m \u001b[38;5;28mlen\u001b[39m(height_ratios) != \u001b[38;5;28mself\u001b[39m._nrows:\n\u001b[32m--> \u001b[39m\u001b[32m132\u001b[39m     \u001b[38;5;28;01mraise\u001b[39;00m \u001b[38;5;167;01mValueError\u001b[39;00m(\u001b[33m'\u001b[39m\u001b[33mExpected the given number of height ratios to \u001b[39m\u001b[33m'\u001b[39m\n\u001b[32m    133\u001b[39m                      \u001b[33m'\u001b[39m\u001b[33mmatch the number of rows of the grid\u001b[39m\u001b[33m'\u001b[39m)\n\u001b[32m    134\u001b[39m \u001b[38;5;28mself\u001b[39m._row_height_ratios = height_ratios\n\n\u001b[31mValueError\u001b[39m: Expected the given number of height ratios to match the number of rows of the grid"},"children":[],"identifier":"tzsxphelq6qb-outputs-0","html_id":"tzsxphelq6qb-outputs-0","key":"QmNAO6Qh1p"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1500x700 with 0 Axes>","content_type":"text/plain"}}},"children":[],"identifier":"tzsxphelq6qb-outputs-1","html_id":"tzsxphelq6qb-outputs-1","key":"w5UW74eAIr"}],"identifier":"tzsxphelq6qb-outputs","html_id":"tzsxphelq6qb-outputs","key":"Hk1rmlPZDi"}],"identifier":"tzsxphelq6qb","label":"tZSXpHELQ6QB","html_id":"tzsxphelq6qb","key":"taT3ocYk6B"},{"type":"block","kind":"notebook-content","data":{"id":"xsMxeF6GPxIP","pycharm":{"name":"#%% md\n"}},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"If you would like to then make deterministic detections from the continuous characteristic functions, the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YUE4gl5PcM"},{"type":"inlineCode","value":"classify","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"J6UXLD0ufK"},{"type":"text","value":" method of each model will allow you to perform this task.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TSeykdp765"}],"key":"S2cnbzMI0k"}],"identifier":"xsmxef6gpxip","label":"xsMxeF6GPxIP","html_id":"xsmxef6gpxip","key":"CQVXuslENm"},{"type":"block","kind":"notebook-code","data":{"ExecuteTime":{"end_time":"2023-08-14T19:49:07.241058Z","start_time":"2023-08-14T19:49:07.039625Z"},"id":"dFmXEm3yYbSn","pycharm":{"name":"#%%\n"}},"children":[{"type":"code","lang":"python","executable":true,"value":"outputs = pn_model.classify(stream)","identifier":"dfmxem3yybsn-code","enumerator":"7","html_id":"dfmxem3yybsn-code","key":"Vw9CnEV1Qe"},{"type":"outputs","id":"AXzkUjmN7zDNoLYkffnH1","children":[],"identifier":"dfmxem3yybsn-outputs","html_id":"dfmxem3yybsn-outputs","key":"JAeLdTZtQj"}],"identifier":"dfmxem3yybsn","label":"dFmXEm3yYbSn","html_id":"dfmxem3yybsn","key":"lzpODH5kss"},{"type":"block","kind":"notebook-code","data":{"ExecuteTime":{"end_time":"2023-08-14T19:49:07.841273Z","start_time":"2023-08-14T19:49:07.835563Z"},"colab":{"base_uri":"https://localhost:8080/"},"id":"zYAGm_HYve38","outputId":"3c381014-f6ba-49e4-ffcf-ec27df7971ec","pycharm":{"name":"#%%\n"}},"children":[{"type":"code","lang":"python","executable":true,"value":"print(outputs)","identifier":"zyagm_hyve38-code","enumerator":"8","html_id":"zyagm-hyve38-code","key":"ctHjYnea7U"},{"type":"outputs","id":"DwbT5LxXZ6q2VkZwNHP2g","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"ClassifyOutput(creator='PhaseNet', picks=PickList with 63 entries:\n\nPB.B047.\t2022-12-20T10:34:32.290000Z\tP\nPB.B047.\t2022-12-20T10:34:37.980000Z\tS\nPB.B047.\t2022-12-20T10:36:06.840000Z\tP\n...\nPB.B047.\t2022-12-20T10:58:09.580000Z\tS\nPB.B047.\t2022-12-20T10:59:20.490000Z\tS\nPB.B047.\t2022-12-20T10:59:55.580000Z\tS)\n"},"children":[],"identifier":"zyagm_hyve38-outputs-0","html_id":"zyagm-hyve38-outputs-0","key":"fw3yBc1egA"}],"identifier":"zyagm_hyve38-outputs","html_id":"zyagm-hyve38-outputs","key":"EX30WH7pAM"}],"identifier":"zyagm_hyve38","label":"zYAGm_HYve38","html_id":"zyagm-hyve38","key":"upvBN0r421"},{"type":"block","kind":"notebook-content","data":{"id":"-MilxbC2QNUD","pycharm":{"name":"#%% md\n"}},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"With each pick storing the following information:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KjbhJTlg9X"}],"key":"OMEtkYgMhM"}],"identifier":"-milxbc2qnud","label":"-MilxbC2QNUD","html_id":"id-milxbc2qnud","key":"H1iUERSBZi"},{"type":"block","kind":"notebook-code","data":{"ExecuteTime":{"end_time":"2023-08-14T19:49:09.544053Z","start_time":"2023-08-14T19:49:09.538330Z"},"colab":{"base_uri":"https://localhost:8080/"},"id":"aftE4ikZKWEh","outputId":"39be2482-cdc0-4e9d-d4c3-04d79cca24ff","pycharm":{"name":"#%%\n"}},"children":[{"type":"code","lang":"python","executable":true,"value":"print(outputs.picks[0].__dict__)","identifier":"afte4ikzkweh-code","enumerator":"9","html_id":"afte4ikzkweh-code","key":"ZpGoxwpMNd"},{"type":"outputs","id":"HA3n97KtPGjZ9j3lbo0GU","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"{'trace_id': 'PB.B047.', 'start_time': UTCDateTime(2022, 12, 20, 10, 34, 31, 910000), 'end_time': UTCDateTime(2022, 12, 20, 10, 34, 32, 770000), 'peak_time': UTCDateTime(2022, 12, 20, 10, 34, 32, 290000), 'peak_value': 0.82617074, 'phase': 'P'}\n"},"children":[],"identifier":"afte4ikzkweh-outputs-0","html_id":"afte4ikzkweh-outputs-0","key":"vMxF1AyFs9"}],"identifier":"afte4ikzkweh-outputs","html_id":"afte4ikzkweh-outputs","key":"MCDo9hAZIO"}],"identifier":"afte4ikzkweh","label":"aftE4ikZKWEh","html_id":"afte4ikzkweh","key":"iuISBJsz3N"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"stream[0].stats.sampling_rate\nprint((outputs.picks[ii].__dict__['peak_time']))\nprint(stream[0].stats.starttime)\n","key":"lVGx6JDNtT"},{"type":"outputs","id":"IH-oBofQKoTRv3USCwyDK","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"2022-12-20T10:34:32.290000Z\n2022-12-20T10:29:59.998400Z\n"},"children":[],"key":"t4dyaGGwVN"}],"key":"rZoe39xdtb"}],"key":"Van1lIYrOE"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import pandas as pd\n\n# Output file\noutput_file = 'seisbench_detections_%s.%s.%s.%s.csv'%(stream[0].stats.network,stream[0].stats.station,stream[0].stats.starttime.year,stream[0].stats.starttime.julday)\n\n# Reformat output to desired structure\nformatted = []\nfor ii in range(len(outputs.picks)):\n    formatted.append({\n        'phase': outputs.picks[ii].__dict__['phase'],\n        'time': outputs.picks[ii].__dict__['peak_time'],  # Convert UTCDateTime to ISO 8601 string\n        'confidence':  outputs.picks[ii].__dict__['peak_value']\n    })\n\n# Convert to DataFrame\ndf = pd.DataFrame(formatted)\n\n# Optional: Save to CSV\ndf.to_csv(output_file, index=False)\n\n! head seisbench_detections_*.csv","key":"QeKXvo6uH0"},{"type":"outputs","id":"6P68CX94OXS9rg134M6mZ","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"phase,time,confidence\nP,2022-12-20T10:34:32.290000Z,0.82617074\nS,2022-12-20T10:34:37.980000Z,0.7456388\nP,2022-12-20T10:36:06.840000Z,0.45904273\nS,2022-12-20T10:36:13.060000Z,0.85334134\nP,2022-12-20T10:36:53.070000Z,0.43234748\nS,2022-12-20T10:37:00.600000Z,0.48813757\nP,2022-12-20T10:37:27.950000Z,0.29602423\nS,2022-12-20T10:37:33.480000Z,0.78957117\nP,2022-12-20T10:38:11.490000Z,0.37381783\n"},"children":[],"key":"g5T6hs3M9c"}],"key":"Xdbe5B7U2U"}],"key":"iIYL7l6aWI"}],"key":"m5vFKhCMmj"},"references":{"cite":{"order":[],"data":{}}}}