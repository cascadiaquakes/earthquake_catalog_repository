{"version":3,"kind":"Notebook","sha256":"d88e138b8d58c63e49d574169bb5867dd0e001a96630449d84aac66d8e12ad3b","slug":"seisbench","location":"/notebooks/Amanda/seisbench.ipynb","dependencies":[],"frontmatter":{"title":"Seisbench (detections the easy way)","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"pytorch","language":"python"},"authors":[{"id":"Amanda M. Thomas, William Marfo, and Loïc Bachelot","name":"Amanda M. Thomas, William Marfo, and Loïc Bachelot"}],"keywords":["earthquake","catalog","ML","AI"],"numbering":{"title":{"offset":1}},"thumbnail":"/050bd234c7374c32150e7c7359aec606.svg","exports":[{"format":"ipynb","filename":"seisbench.ipynb","url":"/seisbench-c284f9b58be85f9cc6151dd35765f466.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{"id":"679a2782","pycharm":{"name":"#%% md\n"}},"children":[{"type":"image","url":"/050bd234c7374c32150e7c7359aec606.svg","alt":"image","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"toqJJMMjgt","urlSource":"https://raw.githubusercontent.com/seisbench/seisbench/main/docs/_static/seisbench_logo_subtitle_outlined.svg"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Author:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"VjfRrmhJo1"}],"key":"hhlUsLeoLy"},{"type":"text","value":" Amanda M. Thomas (modified from Seisbench colab notebook for Ferndale)\n","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"VA7DDd9CY8"},{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Goal:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"vDCvE3634G"}],"key":"f59Ca2vawj"},{"type":"text","value":" A quick Seisbench demonstration.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"PBXwj3Oqug"}],"key":"L3UlBqst7c"}],"identifier":"679a2782","label":"679a2782","html_id":"id-679a2782","key":"mgNbYZjQn8"},{"type":"block","kind":"notebook-code","data":{"ExecuteTime":{"end_time":"2023-08-14T19:48:28.892368Z","start_time":"2023-08-14T19:48:27.814671Z"},"id":"f2ad2b47","pycharm":{"name":"#%%\n"}},"children":[{"type":"code","lang":"python","executable":true,"value":"import seisbench\nimport seisbench.models as sbm","identifier":"f2ad2b47-code","enumerator":"1","html_id":"f2ad2b47-code","key":"snPO8ejq9T"},{"type":"outputs","id":"4kyILdvUVRpKNOwJPfvv5","children":[],"identifier":"f2ad2b47-outputs","html_id":"f2ad2b47-outputs","key":"DlBtfpma44"}],"identifier":"f2ad2b47","label":"f2ad2b47","html_id":"f2ad2b47","key":"kz6aU0vM66"},{"type":"block","kind":"notebook-content","data":{"id":"df9e9d86","pycharm":{"name":"#%% md\n"}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Creating a model","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"t6Ezis6iWv"}],"identifier":"creating-a-model","label":"Creating a model","html_id":"creating-a-model","implicit":true,"key":"iTV8TLa3dT"}],"identifier":"df9e9d86","label":"df9e9d86","html_id":"df9e9d86","key":"ecFXF0lIXx"},{"type":"block","kind":"notebook-content","data":{"id":"6f61e723","pycharm":{"name":"#%% md\n"}},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Here you can download your pretrained model for predicting on the example streams.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CVhmf6p0kj"}],"identifier":"here-you-can-download-your-pretrained-model-for-predicting-on-the-example-streams","label":"Here you can download your pretrained model for predicting on the example streams.","html_id":"here-you-can-download-your-pretrained-model-for-predicting-on-the-example-streams","implicit":true,"key":"kw8Tab6Cgh"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"if you would like to see the full suite of available pre-trained weights for any model, you can call the ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"gFPlmvNxer"},{"type":"inlineCode","value":"list_pretrained","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"YzWwLhvz0v"},{"type":"text","value":" method, which will return all the associated weights for the model, along with information on the training procedure for each set of weights. For the purposes of this plug-in-and-play example, we comment out a number of available models, for you to load and try out.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"SPOJlatCRo"}],"key":"eUpO4Dp2iW"}],"identifier":"6f61e723","label":"6f61e723","html_id":"id-6f61e723","key":"Z291OWPn5B"},{"type":"block","kind":"notebook-code","data":{"ExecuteTime":{"end_time":"2023-08-14T19:48:29.580648Z","start_time":"2023-08-14T19:48:29.462859Z"},"id":"4e34Nh1TTFsq","pycharm":{"name":"#%%\n"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Various pre-trained weights for PhaseNet\n# pn_model = sbm.PhaseNet.from_pretrained(\"ethz\")\n# pn_model = sbm.PhaseNet.from_pretrained(\"instance\")\n# pn_model = sbm.PhaseNet.from_pretrained(\"scedc\")\npn_model = sbm.PhaseNet.from_pretrained(\"stead\")\n# pn_model = sbm.PhaseNet.from_pretrained(\"geofon\")\n# pn_model = sbm.PhaseNet.from_pretrained(\"neic\")\n\n# Various pre-trained weights for EQT\neqt_model = sbm.EQTransformer.from_pretrained(\"original\")\n# eqt_model = sbm.EQTransformer.from_pretrained(\"ethz\")\n# eqt_model = sbm.EQTransformer.from_pretrained(\"instance\")\n# eqt_model = sbm.EQTransformer.from_pretrained(\"scedc\")\n# eqt_model = sbm.EQTransformer.from_pretrained(\"stead\")\n# eqt_model = sbm.EQTransformer.from_pretrained(\"geofon\")\n\n# Various pre-trained weights for GPD\n# gpd_model = sbm.GPD.from_pretrained(\"original\")\n# gpd_model = sbm.GPD.from_pretrained(\"ethz\")\n# gpd_model = sbm.GPD.from_pretrained(\"scedc\")\ngpd_model = sbm.GPD.from_pretrained(\"stead\")\n# gpd_model = sbm.GPD.from_pretrained(\"geofon\")\n# gpd_model = sbm.GPD.from_pretrained(\"neic\")","identifier":"4e34nh1ttfsq-code","enumerator":"2","html_id":"id-4e34nh1ttfsq-code","key":"SCPSOWREFh"},{"type":"outputs","id":"cuIPRG6whuK5Sx0lr_UTA","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/Users/amt/anaconda3/envs/pytorch/lib/python3.12/site-packages/seisbench/models/base.py:489: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.\n  model_weights = torch.load(f\"{path_pt}\")\n"},"children":[],"identifier":"4e34nh1ttfsq-outputs-0","html_id":"id-4e34nh1ttfsq-outputs-0","key":"FF7Tak2SOd"}],"identifier":"4e34nh1ttfsq-outputs","html_id":"id-4e34nh1ttfsq-outputs","key":"LSb3ANHcrl"}],"identifier":"4e34nh1ttfsq","label":"4e34Nh1TTFsq","html_id":"id-4e34nh1ttfsq","key":"cRn7GxLZ0g"},{"type":"block","kind":"notebook-content","data":{"id":"jWCjFmtHTOGC","pycharm":{"name":"#%% md\n"}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Read in waveforms","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"O6RgyDdBoe"}],"identifier":"read-in-waveforms","label":"Read in waveforms","html_id":"read-in-waveforms","implicit":true,"key":"dCeRTxUukB"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"This waveform example contains part of the 2009 L’Acquila earthquake sequence occuring in the Abruzzo region of central Italy. The Mw 6.4 mainshock is located ~2 minutes into the seismic recording, with many afterhshocks occuring directly after. The seismic trace loaded in from obspy spans the ~1 hour period immediately following the mainshock.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"XEH6FwNN6x"}],"key":"hRSOGDxokW"}],"identifier":"jwcjfmthtogc","label":"jWCjFmtHTOGC","html_id":"jwcjfmthtogc","key":"zy1OGbiiNm"},{"type":"block","kind":"notebook-code","data":{"ExecuteTime":{"end_time":"2023-08-14T19:48:38.203475Z","start_time":"2023-08-14T19:48:32.214108Z"},"colab":{"base_uri":"https://localhost:8080/","height":331},"id":"pvK617WcNZRx","outputId":"bfe423c9-8b79-4a06-f1e7-fd8e71929783","pycharm":{"name":"#%%\n"}},"children":[{"type":"code","lang":"python","executable":true,"value":"from obspy.clients.fdsn import Client\nfrom obspy import UTCDateTime\nimport matplotlib.pyplot as plt\nimport obspy as obs\nimport numpy as np\nimport matplotlib.pyplot as plt\n\n# Load the data\nstream = obs.read('../data/B047*')\nstream = obs.read('../../../shared/shortcourses/crescent_ml_2025/miniseed/B047*')\n\n# Detrend the data\nstream.detrend(\"linear\")\n\n# Trim to earthquake time\nstream.trim(starttime=UTCDateTime(2022,12,20,10,30,00),endtime=UTCDateTime(2022,12,20,11,00,00))\n\n# Plot the data\nfig = plt.figure(figsize=(20, 5))\nax = fig.add_subplot(111)\nfor i in range(3):\n    ax.plot(stream[i].times(), stream[i].data, label=stream[i].stats.channel)\nax.legend();","identifier":"pvk617wcnzrx-code","enumerator":"3","html_id":"pvk617wcnzrx-code","key":"Unelk80y52"},{"type":"outputs","id":"-r6DKHDBxcH8z2vzd15H4","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"62f1dc4efa3a9ba83fd0ca53b60183f2","path":"/62f1dc4efa3a9ba83fd0ca53b60183f2.png"},"text/plain":{"content":"<Figure size 2000x500 with 1 Axes>","content_type":"text/plain"}}},"children":[],"identifier":"pvk617wcnzrx-outputs-0","html_id":"pvk617wcnzrx-outputs-0","key":"EId1ARs4b2"}],"identifier":"pvk617wcnzrx-outputs","html_id":"pvk617wcnzrx-outputs","key":"KYcBaL5iU7"}],"identifier":"pvk617wcnzrx","label":"pvK617WcNZRx","html_id":"pvk617wcnzrx","key":"pv404osvtK"},{"type":"block","kind":"notebook-content","data":{"id":"oholMBLyTRw1","pycharm":{"name":"#%% md\n"}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Predict model on seismic stream","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EOUC5pBr62"}],"identifier":"predict-model-on-seismic-stream","label":"Predict model on seismic stream","html_id":"predict-model-on-seismic-stream","implicit":true,"key":"LvPRrW91XQ"}],"identifier":"oholmblytrw1","label":"oholMBLyTRw1","html_id":"oholmblytrw1","key":"umspB8qMTQ"},{"type":"block","kind":"notebook-content","data":{"id":"yi_krX7Q4vU_","pycharm":{"name":"#%% md\n"}},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We can apply our varying models now to the seismic stream through the high level ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BgAhD4Ete1"},{"type":"inlineCode","value":"annotate","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mFRSDOBOZN"},{"type":"text","value":" method. This will output the charactersitic functions for the probability of a P-phase, S-phase, and noise class respectively.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"A79zzTwaMw"}],"key":"aQIGHhl7vj"}],"identifier":"yi_krx7q4vu_","label":"yi_krX7Q4vU_","html_id":"yi-krx7q4vu","key":"g3szqv0Gym"},{"type":"block","kind":"notebook-code","data":{"ExecuteTime":{"end_time":"2023-08-14T19:48:47.808135Z","start_time":"2023-08-14T19:48:38.205050Z"},"colab":{"base_uri":"https://localhost:8080/"},"id":"lj_W0_LcQKyO","outputId":"992799ba-1d68-47fd-8312-d1e957a3a9e5","pycharm":{"name":"#%%\n"}},"children":[{"type":"code","lang":"python","executable":true,"value":"pn_preds = pn_model.annotate(stream)\neqt_preds = eqt_model.annotate(stream)\ngpd_preds = gpd_model.annotate(stream)\n\npn_preds","identifier":"lj_w0_lcqkyo-code","enumerator":"4","html_id":"lj-w0-lcqkyo-code","key":"BQdnIj2uNi"},{"type":"outputs","id":"uhpsP6w_Rg9zblEe9oggg","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":14,"metadata":{},"data":{"text/plain":{"content":"3 Trace(s) in Stream:\nPB.B047..PhaseNet_P | 2022-12-20T10:30:02.500000Z - 2022-12-20T10:59:57.500000Z | 100.0 Hz, 179501 samples\nPB.B047..PhaseNet_S | 2022-12-20T10:30:02.500000Z - 2022-12-20T10:59:57.500000Z | 100.0 Hz, 179501 samples\nPB.B047..PhaseNet_N | 2022-12-20T10:30:02.500000Z - 2022-12-20T10:59:57.500000Z | 100.0 Hz, 179501 samples","content_type":"text/plain"}}},"children":[],"identifier":"lj_w0_lcqkyo-outputs-0","html_id":"lj-w0-lcqkyo-outputs-0","key":"XaH8Y1CWOz"}],"identifier":"lj_w0_lcqkyo-outputs","html_id":"lj-w0-lcqkyo-outputs","key":"M2zw27FUCl"}],"identifier":"lj_w0_lcqkyo","label":"lj_W0_LcQKyO","html_id":"lj-w0-lcqkyo","key":"nGnmrwsr8S"},{"type":"block","kind":"notebook-content","data":{"id":"vATAaDohTYwj","pycharm":{"name":"#%% md\n"}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Step through to ‘zoom in’ on predictions","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wj0AabtDFw"}],"identifier":"step-through-to-zoom-in-on-predictions","label":"Step through to ‘zoom in’ on predictions","html_id":"step-through-to-zoom-in-on-predictions","implicit":true,"key":"ZvZnoqkJEn"}],"identifier":"vataadohtywj","label":"vATAaDohTYwj","html_id":"vataadohtywj","key":"lbVpaXOKbz"},{"type":"block","kind":"notebook-content","data":{"id":"XQzmBfSv5wUn","pycharm":{"name":"#%% md\n"}},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Enter window length in seconds, and define which model predictions you would like to plot","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jqEDPVVf99"}],"key":"KDghaeneB9"}],"identifier":"xqzmbfsv5wun","label":"XQzmBfSv5wUn","html_id":"xqzmbfsv5wun","key":"Qf0ubgifkI"},{"type":"block","kind":"notebook-code","data":{"ExecuteTime":{"end_time":"2023-08-14T19:48:47.811243Z","start_time":"2023-08-14T19:48:47.809587Z"},"cellView":"form","id":"T8Ce2LYe5oVu","pycharm":{"name":"#%%\n"}},"children":[{"type":"code","lang":"python","executable":true,"value":"wlength = 3 * 60 #@param","identifier":"t8ce2lye5ovu-code","enumerator":"5","html_id":"t8ce2lye5ovu-code","key":"DlQ8nFhRsc"},{"type":"outputs","id":"9R_7J1XmSp2GKZjSL0sCd","children":[],"identifier":"t8ce2lye5ovu-outputs","html_id":"t8ce2lye5ovu-outputs","key":"tmhFNT6zzQ"}],"identifier":"t8ce2lye5ovu","label":"T8Ce2LYe5oVu","html_id":"t8ce2lye5ovu","key":"roc0HZxKN2"},{"type":"block","kind":"notebook-code","data":{"ExecuteTime":{"end_time":"2023-08-14T19:48:51.391411Z","start_time":"2023-08-14T19:48:47.812451Z"},"colab":{"base_uri":"https://localhost:8080/","height":1000},"id":"tZSXpHELQ6QB","outputId":"78b62541-7ab9-4bb1-a9a4-f1cf0404193a","pycharm":{"name":"#%%\n"},"scrolled":false},"children":[{"type":"code","lang":"python","executable":true,"value":"color_dict = {\"P\": \"C0\", \"S\": \"C1\", \"Detection\": \"C2\"}\n\nfor s in range(0, int(stream[0].stats.endtime - stream[0].stats.starttime), wlength):\n    t0 = stream[0].stats.starttime + s\n    t1 = t0 + wlength\n    subst = stream.copy().slice(t0, t1)\n\n    fig, ax = plt.subplots(4, 1, figsize=(15, 7), sharex=True, gridspec_kw={'hspace' : 0.05, 'height_ratios': [2, 1, 1, 1]})\n\n    for i, preds in enumerate([eqt_preds, pn_preds, gpd_preds]):\n        subpreds = preds.slice(t0, t1)\n        offset = subpreds[0].stats.starttime - subst[0].stats.starttime\n        for pred_trace in subpreds:\n            model, pred_class = pred_trace.stats.channel.split(\"_\")\n            if pred_class == \"N\":\n                # Skip noise traces\n                continue\n            c = color_dict[pred_class]\n            ax[i + 1].plot(offset + pred_trace.times(), pred_trace.data, label=pred_class, c=c)\n        ax[i + 1].set_ylabel(model)\n        ax[i + 1].legend(loc=2)\n        ax[i + 1].set_ylim(0, 1.1)\n\n    ax[0].plot(subst[-1].times(), subst[-1].data / np.amax(subst[-1].data), 'k', label=subst[-1].stats.channel)\n    ax[0].set_xlim(0, wlength)\n    ax[0].set_ylabel('Normalised Amplitude')\n    ax[3].set_xlabel('Time [s]')\n    ax[0].legend(loc=2)\n    plt.show()","identifier":"tzsxphelq6qb-code","enumerator":"6","html_id":"tzsxphelq6qb-code","key":"m9Iz29JGhZ"},{"type":"outputs","id":"JpFKAHj9UKVexcFE5EFM2","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"e095bfafa35a9969d85a47ab0e3763f2","path":"/e095bfafa35a9969d85a47ab0e3763f2.png"},"text/plain":{"content":"<Figure size 1500x700 with 4 Axes>","content_type":"text/plain"}}},"children":[],"identifier":"tzsxphelq6qb-outputs-0","html_id":"tzsxphelq6qb-outputs-0","key":"AwOF6DmpdY"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"f2cf87ee2f5aa37a0bdf5340a6134efd","path":"/f2cf87ee2f5aa37a0bdf5340a6134efd.png"},"text/plain":{"content":"<Figure size 1500x700 with 4 Axes>","content_type":"text/plain"}}},"children":[],"identifier":"tzsxphelq6qb-outputs-1","html_id":"tzsxphelq6qb-outputs-1","key":"N4jiD9VFUb"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"699e7841455f24c67e464eafb9204174","path":"/699e7841455f24c67e464eafb9204174.png"},"text/plain":{"content":"<Figure size 1500x700 with 4 Axes>","content_type":"text/plain"}}},"children":[],"identifier":"tzsxphelq6qb-outputs-2","html_id":"tzsxphelq6qb-outputs-2","key":"j4psxNgvDN"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"960345e5f29c75dd0991f028caca3bee","path":"/960345e5f29c75dd0991f028caca3bee.png"},"text/plain":{"content":"<Figure size 1500x700 with 4 Axes>","content_type":"text/plain"}}},"children":[],"identifier":"tzsxphelq6qb-outputs-3","html_id":"tzsxphelq6qb-outputs-3","key":"ihZKDZbL2y"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"d233642487fb4c4e109b9e29918e398c","path":"/d233642487fb4c4e109b9e29918e398c.png"},"text/plain":{"content":"<Figure size 1500x700 with 4 Axes>","content_type":"text/plain"}}},"children":[],"identifier":"tzsxphelq6qb-outputs-4","html_id":"tzsxphelq6qb-outputs-4","key":"fM7SQRBUBA"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"8d96755cb9d5874a3f8c4d91d9a53eaf","path":"/8d96755cb9d5874a3f8c4d91d9a53eaf.png"},"text/plain":{"content":"<Figure size 1500x700 with 4 Axes>","content_type":"text/plain"}}},"children":[],"identifier":"tzsxphelq6qb-outputs-5","html_id":"tzsxphelq6qb-outputs-5","key":"bOq4VueYvG"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"888d3ce6de196b15f2bba4bc5118a280","path":"/888d3ce6de196b15f2bba4bc5118a280.png"},"text/plain":{"content":"<Figure size 1500x700 with 4 Axes>","content_type":"text/plain"}}},"children":[],"identifier":"tzsxphelq6qb-outputs-6","html_id":"tzsxphelq6qb-outputs-6","key":"PaEi3p4EhN"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"85178b114916ff5026695b81f769452c","path":"/85178b114916ff5026695b81f769452c.png"},"text/plain":{"content":"<Figure size 1500x700 with 4 Axes>","content_type":"text/plain"}}},"children":[],"identifier":"tzsxphelq6qb-outputs-7","html_id":"tzsxphelq6qb-outputs-7","key":"T5EQ8jXMAW"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"cbc3216bea89447b9f7cdcd57fe2ec06","path":"/cbc3216bea89447b9f7cdcd57fe2ec06.png"},"text/plain":{"content":"<Figure size 1500x700 with 4 Axes>","content_type":"text/plain"}}},"children":[],"identifier":"tzsxphelq6qb-outputs-8","html_id":"tzsxphelq6qb-outputs-8","key":"ronUr52chP"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"408d3c896731718dfb72fd75bb34b969","path":"/408d3c896731718dfb72fd75bb34b969.png"},"text/plain":{"content":"<Figure size 1500x700 with 4 Axes>","content_type":"text/plain"}}},"children":[],"identifier":"tzsxphelq6qb-outputs-9","html_id":"tzsxphelq6qb-outputs-9","key":"cqgrl4Vgax"}],"identifier":"tzsxphelq6qb-outputs","html_id":"tzsxphelq6qb-outputs","key":"JQ0magvyxD"}],"identifier":"tzsxphelq6qb","label":"tZSXpHELQ6QB","html_id":"tzsxphelq6qb","key":"o38SDbVoKO"},{"type":"block","kind":"notebook-content","data":{"id":"xsMxeF6GPxIP","pycharm":{"name":"#%% md\n"}},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"If you would like to then make deterministic detections from the continuous characteristic functions, the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wHRlgmAvne"},{"type":"inlineCode","value":"classify","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OoYpJYhIkT"},{"type":"text","value":" method of each model will allow you to perform this task.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lUvVtdwGyB"}],"key":"TvToOub5r5"}],"identifier":"xsmxef6gpxip","label":"xsMxeF6GPxIP","html_id":"xsmxef6gpxip","key":"uYDgnSfz1R"},{"type":"block","kind":"notebook-code","data":{"ExecuteTime":{"end_time":"2023-08-14T19:49:07.241058Z","start_time":"2023-08-14T19:49:07.039625Z"},"id":"dFmXEm3yYbSn","pycharm":{"name":"#%%\n"}},"children":[{"type":"code","lang":"python","executable":true,"value":"outputs = pn_model.classify(stream)","identifier":"dfmxem3yybsn-code","enumerator":"7","html_id":"dfmxem3yybsn-code","key":"BF8U4YyOrN"},{"type":"outputs","id":"0NntyaFLwKsdVC5s6kGwv","children":[],"identifier":"dfmxem3yybsn-outputs","html_id":"dfmxem3yybsn-outputs","key":"uG5Sfo1qzU"}],"identifier":"dfmxem3yybsn","label":"dFmXEm3yYbSn","html_id":"dfmxem3yybsn","key":"JBEML260a3"},{"type":"block","kind":"notebook-code","data":{"ExecuteTime":{"end_time":"2023-08-14T19:49:07.841273Z","start_time":"2023-08-14T19:49:07.835563Z"},"colab":{"base_uri":"https://localhost:8080/"},"id":"zYAGm_HYve38","outputId":"3c381014-f6ba-49e4-ffcf-ec27df7971ec","pycharm":{"name":"#%%\n"}},"children":[{"type":"code","lang":"python","executable":true,"value":"print(outputs)","identifier":"zyagm_hyve38-code","enumerator":"8","html_id":"zyagm-hyve38-code","key":"sAGRU7n7Bq"},{"type":"outputs","id":"AhnjfdMkQwHn14MFhFqA0","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"ClassifyOutput(creator='PhaseNet', picks=PickList with 63 entries:\n\nPB.B047.\t2022-12-20T10:34:32.290000Z\tP\nPB.B047.\t2022-12-20T10:34:37.980000Z\tS\nPB.B047.\t2022-12-20T10:36:06.840000Z\tP\n...\nPB.B047.\t2022-12-20T10:58:09.580000Z\tS\nPB.B047.\t2022-12-20T10:59:20.490000Z\tS\nPB.B047.\t2022-12-20T10:59:55.580000Z\tS)\n"},"children":[],"identifier":"zyagm_hyve38-outputs-0","html_id":"zyagm-hyve38-outputs-0","key":"ggYgxdhEG7"}],"identifier":"zyagm_hyve38-outputs","html_id":"zyagm-hyve38-outputs","key":"N66fzWfvXi"}],"identifier":"zyagm_hyve38","label":"zYAGm_HYve38","html_id":"zyagm-hyve38","key":"BNWmxqu54y"},{"type":"block","kind":"notebook-content","data":{"id":"-MilxbC2QNUD","pycharm":{"name":"#%% md\n"}},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"With each pick storing the following information:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kFVKyh2eDJ"}],"key":"TQQAr5FVk8"}],"identifier":"-milxbc2qnud","label":"-MilxbC2QNUD","html_id":"id-milxbc2qnud","key":"IdXhY9sPXv"},{"type":"block","kind":"notebook-code","data":{"ExecuteTime":{"end_time":"2023-08-14T19:49:09.544053Z","start_time":"2023-08-14T19:49:09.538330Z"},"colab":{"base_uri":"https://localhost:8080/"},"id":"aftE4ikZKWEh","outputId":"39be2482-cdc0-4e9d-d4c3-04d79cca24ff","pycharm":{"name":"#%%\n"}},"children":[{"type":"code","lang":"python","executable":true,"value":"print(outputs.picks[0].__dict__)","identifier":"afte4ikzkweh-code","enumerator":"9","html_id":"afte4ikzkweh-code","key":"cVQTTFisID"},{"type":"outputs","id":"rRsWrjAORSwCm2ReR70aM","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"{'trace_id': 'PB.B047.', 'start_time': UTCDateTime(2022, 12, 20, 10, 34, 31, 910000), 'end_time': UTCDateTime(2022, 12, 20, 10, 34, 32, 770000), 'peak_time': UTCDateTime(2022, 12, 20, 10, 34, 32, 290000), 'peak_value': 0.82617074, 'phase': 'P'}\n"},"children":[],"identifier":"afte4ikzkweh-outputs-0","html_id":"afte4ikzkweh-outputs-0","key":"kMUnNLBF2Y"}],"identifier":"afte4ikzkweh-outputs","html_id":"afte4ikzkweh-outputs","key":"UTJRXEoqdP"}],"identifier":"afte4ikzkweh","label":"aftE4ikZKWEh","html_id":"afte4ikzkweh","key":"NgVslJoMvQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"stream[0].stats.sampling_rate\nprint((outputs.picks[ii].__dict__['peak_time']))\nprint(stream[0].stats.starttime)\n","key":"GYgdEuSWtg"},{"type":"outputs","id":"bQK54I4Yc5BhPSMPVkRkn","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"2022-12-20T10:34:32.290000Z\n2022-12-20T10:29:59.998400Z\n"},"children":[],"key":"kkD6UeEuof"}],"key":"iJGY9kBjWu"}],"key":"wC4CEJJdKu"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import pandas as pd\n\n# Output file\noutput_file = 'seisbench_detections_%s.%s.%s.%s.csv'%(stream[0].stats.network,stream[0].stats.station,stream[0].stats.starttime.year,stream[0].stats.starttime.julday)\n\n# Reformat output to desired structure\nformatted = []\nfor ii in range(len(outputs.picks)):\n    formatted.append({\n        'phase': outputs.picks[ii].__dict__['phase'],\n        'time': outputs.picks[ii].__dict__['peak_time'],  # Convert UTCDateTime to ISO 8601 string\n        'confidence':  outputs.picks[ii].__dict__['peak_value']\n    })\n\n# Convert to DataFrame\ndf = pd.DataFrame(formatted)\n\n# Optional: Save to CSV\ndf.to_csv(output_file, index=False)\n\n! head seisbench_detections_*.csv","key":"mIps6baksH"},{"type":"outputs","id":"4EipyTnFfia7_RapYVKOd","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"phase,time,confidence\nP,2022-12-20T10:34:32.290000Z,0.82617074\nS,2022-12-20T10:34:37.980000Z,0.7456388\nP,2022-12-20T10:36:06.840000Z,0.45904273\nS,2022-12-20T10:36:13.060000Z,0.85334134\nP,2022-12-20T10:36:53.070000Z,0.43234748\nS,2022-12-20T10:37:00.600000Z,0.48813757\nP,2022-12-20T10:37:27.950000Z,0.29602423\nS,2022-12-20T10:37:33.480000Z,0.78957117\nP,2022-12-20T10:38:11.490000Z,0.37381783\n"},"children":[],"key":"YgOzybGSwP"}],"key":"CUv57U0Idw"}],"key":"fR4fQh986i"}],"key":"YuQOQIwSoj"},"references":{"cite":{"order":[],"data":{}}}}