{"version":3,"kind":"Notebook","sha256":"2e92edcafac05f47f06da04db476ae174fd7804dfa7804d48d95a0568c9571e2","slug":"run-hypodd-plot","location":"/notebooks/Felix/run_hypoDD_plot.ipynb","dependencies":[],"frontmatter":{"title":"Double Different Relocation","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"mlgeo","language":"python"},"authors":[{"id":"Amanda M. Thomas, William Marfo, and Loïc Bachelot","name":"Amanda M. Thomas, William Marfo, and Loïc Bachelot"}],"keywords":["earthquake","catalog","ML","AI"],"numbering":{"title":{"offset":2}},"exports":[{"format":"ipynb","filename":"run_hypoDD_plot.ipynb","url":"/run_hypoDD_plot-5d4e28477f71df770a9063eeb24fe967.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This notebook will take the phase picks from the associated picks, perform double difference relocation, and plot the earthquake catalog.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"qyU9xcoK0f"}],"key":"TcunWT5Ptt"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"by Felix Waldhauser","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"auivRjqcJk"}],"key":"hSERNLzexr"}],"key":"C0cyaxFZ57"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"1. Compute differential times from phase file","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nK65oXvXov"}],"identifier":"id-1-compute-differential-times-from-phase-file","label":"1. Compute differential times from phase file","html_id":"id-1-compute-differential-times-from-phase-file","implicit":true,"key":"qaaeTUGSC7"}],"key":"ec0m7Sqnl7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%cd /app/hypodd/results_hypodd\n%pwd\n!ph2dt ph2dt.inp","key":"g9xl1tUNmy"},{"type":"outputs","id":"OoeQbruDCmbL_68PxjyvJ","children":[],"key":"SdcHnmcWe6"}],"key":"eEIAYoYPTX"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2. Run double-difference relocation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WZd5DyuoMn"}],"identifier":"id-2-run-double-difference-relocation","label":"2. Run double-difference relocation","html_id":"id-2-run-double-difference-relocation","implicit":true,"key":"wbhUJIRoXQ"}],"key":"PF8GT2iCCI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"!hypoDD hypoDD.inp","key":"xfA1qeBSlv"},{"type":"outputs","id":"vRuozzZqT486H_Bzh0uK-","children":[],"key":"bHsu5V1MHp"}],"key":"UC4WIv5csT"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3. Manipulate the new catalog","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AluMZwaaHU"}],"identifier":"id-3-manipulate-the-new-catalog","label":"3. Manipulate the new catalog","html_id":"id-3-manipulate-the-new-catalog","implicit":true,"key":"hYuo2j54Qq"}],"key":"BCnoWaz56F"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import pandas as pd\nimport matplotlib.pyplot as plt\nimport numpy as np","key":"OC6kKstQhg"},{"type":"outputs","id":"-gya0qvrgYCkzrf92Cj79","children":[],"key":"erO4lH6ha8"}],"key":"iVmGGf0tGz"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Read the relocated catalog","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OifZotZyFO"}],"key":"CwWHO2uSk7"}],"key":"G4dh8yHNmP"}],"key":"xeGgqCL9fY"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"events_hypodd = pd.read_csv('./hypoDD.reloc',header=None, sep=\"\\s+\",names=['ID', 'LAT', 'LON', 'DEPTH', 'X', 'Y', 'Z', 'EX', 'EY', 'EZ', 'YR', 'MO', 'DY', 'HR', 'MI', 'SC', 'MAG', 'NCCP', 'NCCS', 'NCTP', 'NCTS', 'RCC', 'RCT', 'CID'])\nevents_hypodd","key":"Vi6hMx244a"},{"type":"outputs","id":"xw4-WJ17vLTPXifRZre0Q","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":2,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>ID</th>\n      <th>LAT</th>\n      <th>LON</th>\n      <th>DEPTH</th>\n      <th>X</th>\n      <th>Y</th>\n      <th>Z</th>\n      <th>EX</th>\n      <th>EY</th>\n      <th>EZ</th>\n      <th>...</th>\n      <th>MI</th>\n      <th>SC</th>\n      <th>MAG</th>\n      <th>NCCP</th>\n      <th>NCCS</th>\n      <th>NCTP</th>\n      <th>NCTS</th>\n      <th>RCC</th>\n      <th>RCT</th>\n      <th>CID</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>10</td>\n      <td>40.479472</td>\n      <td>-124.313924</td>\n      <td>17.746</td>\n      <td>-7130.8</td>\n      <td>-7587.8</td>\n      <td>-504.3</td>\n      <td>495.2</td>\n      <td>464.1</td>\n      <td>446.2</td>\n      <td>...</td>\n      <td>19</td>\n      <td>14.89</td>\n      <td>0.19</td>\n      <td>0</td>\n      <td>0</td>\n      <td>55</td>\n      <td>51</td>\n      <td>-9.0</td>\n      <td>0.140</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>13</td>\n      <td>40.406616</td>\n      <td>-124.365373</td>\n      <td>14.527</td>\n      <td>-11497.3</td>\n      <td>-15678.1</td>\n      <td>-3723.3</td>\n      <td>690.2</td>\n      <td>1026.9</td>\n      <td>762.1</td>\n      <td>...</td>\n      <td>29</td>\n      <td>21.75</td>\n      <td>0.73</td>\n      <td>0</td>\n      <td>0</td>\n      <td>12</td>\n      <td>4</td>\n      <td>-9.0</td>\n      <td>0.150</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>14</td>\n      <td>40.514408</td>\n      <td>-124.419613</td>\n      <td>15.401</td>\n      <td>-16083.8</td>\n      <td>-3708.3</td>\n      <td>-2849.4</td>\n      <td>192.7</td>\n      <td>270.9</td>\n      <td>159.0</td>\n      <td>...</td>\n      <td>34</td>\n      <td>24.66</td>\n      <td>6.09</td>\n      <td>0</td>\n      <td>0</td>\n      <td>654</td>\n      <td>711</td>\n      <td>-9.0</td>\n      <td>0.211</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>15</td>\n      <td>40.588436</td>\n      <td>-124.114697</td>\n      <td>17.217</td>\n      <td>9745.9</td>\n      <td>4512.1</td>\n      <td>-1033.3</td>\n      <td>140.1</td>\n      <td>208.6</td>\n      <td>287.0</td>\n      <td>...</td>\n      <td>35</td>\n      <td>59.17</td>\n      <td>3.73</td>\n      <td>0</td>\n      <td>0</td>\n      <td>604</td>\n      <td>798</td>\n      <td>-9.0</td>\n      <td>0.168</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>16</td>\n      <td>40.517322</td>\n      <td>-124.329557</td>\n      <td>17.127</td>\n      <td>-8453.4</td>\n      <td>-3384.8</td>\n      <td>-1123.4</td>\n      <td>194.0</td>\n      <td>236.8</td>\n      <td>165.0</td>\n      <td>...</td>\n      <td>36</td>\n      <td>14.62</td>\n      <td>3.13</td>\n      <td>0</td>\n      <td>0</td>\n      <td>156</td>\n      <td>443</td>\n      <td>-9.0</td>\n      <td>0.109</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>1050</th>\n      <td>1157</td>\n      <td>40.539779</td>\n      <td>-123.959904</td>\n      <td>19.063</td>\n      <td>22862.3</td>\n      <td>-891.0</td>\n      <td>812.6</td>\n      <td>255.0</td>\n      <td>327.8</td>\n      <td>480.5</td>\n      <td>...</td>\n      <td>54</td>\n      <td>8.52</td>\n      <td>0.57</td>\n      <td>0</td>\n      <td>0</td>\n      <td>446</td>\n      <td>560</td>\n      <td>-9.0</td>\n      <td>0.167</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>1051</th>\n      <td>1158</td>\n      <td>40.576978</td>\n      <td>-124.399479</td>\n      <td>22.143</td>\n      <td>-14371.3</td>\n      <td>3239.7</td>\n      <td>3892.7</td>\n      <td>572.0</td>\n      <td>520.1</td>\n      <td>569.1</td>\n      <td>...</td>\n      <td>55</td>\n      <td>52.26</td>\n      <td>0.75</td>\n      <td>0</td>\n      <td>0</td>\n      <td>11</td>\n      <td>9</td>\n      <td>-9.0</td>\n      <td>0.188</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>1052</th>\n      <td>1159</td>\n      <td>40.531274</td>\n      <td>-124.299154</td>\n      <td>15.873</td>\n      <td>-5876.8</td>\n      <td>-1835.4</td>\n      <td>-2377.1</td>\n      <td>308.1</td>\n      <td>240.9</td>\n      <td>309.0</td>\n      <td>...</td>\n      <td>56</td>\n      <td>37.56</td>\n      <td>0.74</td>\n      <td>0</td>\n      <td>0</td>\n      <td>232</td>\n      <td>293</td>\n      <td>-9.0</td>\n      <td>0.175</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>1053</th>\n      <td>1160</td>\n      <td>40.633927</td>\n      <td>-123.987695</td>\n      <td>19.623</td>\n      <td>20493.8</td>\n      <td>9563.7</td>\n      <td>1372.9</td>\n      <td>192.8</td>\n      <td>278.0</td>\n      <td>307.1</td>\n      <td>...</td>\n      <td>58</td>\n      <td>40.20</td>\n      <td>1.13</td>\n      <td>0</td>\n      <td>0</td>\n      <td>370</td>\n      <td>412</td>\n      <td>-9.0</td>\n      <td>0.179</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>1054</th>\n      <td>1161</td>\n      <td>40.628231</td>\n      <td>-124.004533</td>\n      <td>17.401</td>\n      <td>19069.2</td>\n      <td>8931.2</td>\n      <td>-849.6</td>\n      <td>186.2</td>\n      <td>260.1</td>\n      <td>280.6</td>\n      <td>...</td>\n      <td>59</td>\n      <td>34.48</td>\n      <td>0.62</td>\n      <td>0</td>\n      <td>0</td>\n      <td>190</td>\n      <td>217</td>\n      <td>-9.0</td>\n      <td>0.188</td>\n      <td>1</td>\n    </tr>\n  </tbody>\n</table>\n<p>1055 rows × 24 columns</p>\n</div>","content_type":"text/html"},"text/plain":{"content":"        ID        LAT         LON   DEPTH        X        Y       Z     EX  \\\n0       10  40.479472 -124.313924  17.746  -7130.8  -7587.8  -504.3  495.2   \n1       13  40.406616 -124.365373  14.527 -11497.3 -15678.1 -3723.3  690.2   \n2       14  40.514408 -124.419613  15.401 -16083.8  -3708.3 -2849.4  192.7   \n3       15  40.588436 -124.114697  17.217   9745.9   4512.1 -1033.3  140.1   \n4       16  40.517322 -124.329557  17.127  -8453.4  -3384.8 -1123.4  194.0   \n...    ...        ...         ...     ...      ...      ...     ...    ...   \n1050  1157  40.539779 -123.959904  19.063  22862.3   -891.0   812.6  255.0   \n1051  1158  40.576978 -124.399479  22.143 -14371.3   3239.7  3892.7  572.0   \n1052  1159  40.531274 -124.299154  15.873  -5876.8  -1835.4 -2377.1  308.1   \n1053  1160  40.633927 -123.987695  19.623  20493.8   9563.7  1372.9  192.8   \n1054  1161  40.628231 -124.004533  17.401  19069.2   8931.2  -849.6  186.2   \n\n          EY     EZ  ...  MI     SC   MAG  NCCP  NCCS  NCTP  NCTS  RCC    RCT  \\\n0      464.1  446.2  ...  19  14.89  0.19     0     0    55    51 -9.0  0.140   \n1     1026.9  762.1  ...  29  21.75  0.73     0     0    12     4 -9.0  0.150   \n2      270.9  159.0  ...  34  24.66  6.09     0     0   654   711 -9.0  0.211   \n3      208.6  287.0  ...  35  59.17  3.73     0     0   604   798 -9.0  0.168   \n4      236.8  165.0  ...  36  14.62  3.13     0     0   156   443 -9.0  0.109   \n...      ...    ...  ...  ..    ...   ...   ...   ...   ...   ...  ...    ...   \n1050   327.8  480.5  ...  54   8.52  0.57     0     0   446   560 -9.0  0.167   \n1051   520.1  569.1  ...  55  52.26  0.75     0     0    11     9 -9.0  0.188   \n1052   240.9  309.0  ...  56  37.56  0.74     0     0   232   293 -9.0  0.175   \n1053   278.0  307.1  ...  58  40.20  1.13     0     0   370   412 -9.0  0.179   \n1054   260.1  280.6  ...  59  34.48  0.62     0     0   190   217 -9.0  0.188   \n\n      CID  \n0       1  \n1       1  \n2       1  \n3       1  \n4       1  \n...   ...  \n1050    1  \n1051    1  \n1052    1  \n1053    1  \n1054    1  \n\n[1055 rows x 24 columns]","content_type":"text/plain"}}},"children":[],"key":"xyV56Ja45n"}],"key":"rrMQMZOp1d"}],"key":"PChY5Pfp2s"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dW7r2KpKKu"}],"key":"xyrvB6T8Mx"}],"key":"dcrKPnTCEw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Create a figure for the plot\nfig = plt.figure(figsize=(12, 10))\nax = fig.add_subplot(111)\n\n# Create scatter plot with depth-coded colors\nscatter = ax.scatter(events_hypodd['LON'], events_hypodd['LAT'], \n                    c=events_hypodd['DEPTH'],\n                    cmap='turbo_r',  # Use reversed turbo colormap (red for deep, blue for shallow)\n                    s=80,  # marker size for good visibility\n                    marker='o',\n                    edgecolor='k',\n                    linewidth=0.3,\n                    alpha=0.3)\n\n# Add colorbar with depth information\ncbar = plt.colorbar(scatter, ax=ax, shrink=0.5)  # Adjust shrink to make the colorbar smaller\ncbar.set_label('Depth (km)', fontsize=12, fontweight='bold')\ncbar.ax.tick_params(labelsize=10)\n\n# Set equal aspect ratio for proper geographical representation\nax.set_aspect('equal')\n\n# Add grid with crisp styling\nax.grid(True, linestyle='-', linewidth=0.5, alpha=0.4, color='gray')\n\n# Add descriptive labels\nax.set_xlabel('Longitude (°)', fontsize=14, fontweight='bold')\nax.set_ylabel('Latitude (°)', fontsize=14, fontweight='bold')\nax.set_title('Spatial Distribution of Earthquake Events\\nColor-Coded by Depth', fontsize=16)\n\n# Adjust limits with a small buffer around data points\nbuffer = 0.05\nax.set_xlim(events_hypodd['LON'].min() - buffer, events_hypodd['LON'].max() + buffer)\nax.set_ylim(events_hypodd['LAT'].min() - buffer, events_hypodd['LAT'].max() + buffer)\n\n# Format tick labels\nax.tick_params(axis='both', which='major', labelsize=12)\n\nplt.tight_layout()\nplt.show()","key":"ewXDkFPODZ"},{"type":"outputs","id":"Ia_q9_-9Fl_NHnT8DYjQQ","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"57c881925262e661899a0c3cddf9def6","path":"/57c881925262e661899a0c3cddf9def6.png"},"text/plain":{"content":"<Figure size 1200x1000 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"Hf0jOVnRBv"}],"key":"EfqniIIZ1H"}],"key":"kDsgmiPzUX"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot cross sections","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xNCnvVNu2g"}],"key":"GVUkhmrtk3"}],"key":"GXWks9WYC0"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Find the cross section along the main axis. Use PCA to find the long axis.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Y7TlEg0kCx"}],"key":"gXgzlXcRJ2"}],"key":"VaHOExvdSW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"","key":"CUM53tm8eq"},{"type":"outputs","id":"MK_LyqZ_FPKU3WrlplVTg","children":[],"key":"HSVLasBPyY"}],"key":"yvdckF7DAJ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"","key":"EfBSEnMx6X"},{"type":"outputs","id":"uSuFruSDme4lVjBuBtlrv","children":[],"key":"KdhU56RmBX"}],"key":"gZZcJkcz6M"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from sklearn.decomposition import PCA\nimport numpy as np\n\n# Apply PCA to find the main axis of the earthquake cluster\n\n# Extract coordinates for PCA\ncoords = events_hypodd[['LON', 'LAT']].values\npca = PCA(n_components=2)\npca.fit(coords)\n\n# Project points onto the principal component\nprojected_points = pca.transform(coords)\n\n# Convert projected points to actual distance in km using a crude approximation\n# Scale factor: 1 degree ≈ 111.2 km\nkm_per_degree = 111.2\n\n# Calculate the min and max in the projected space\nmin_proj = projected_points[:, 0].min()\nmax_proj = projected_points[:, 0].max()\n\n# Calculate the total span in original coordinates\nmain_axis_vector = pca.components_[0]  # Vector direction of main axis (LON, LAT)\n\n# Calculate the span in degrees along the principal axis\nspan_degrees = np.sqrt((main_axis_vector[0]**2 + main_axis_vector[1]**2)) * (max_proj - min_proj)\n\n# Convert to kilometers\nspan_km = span_degrees * km_per_degree\n\n# Scale the projection to real distance in km\ndistance_km = (projected_points[:, 0] - min_proj) * span_km / (max_proj - min_proj)\n\n# Create a new figure for the cross-section plot\nfig, ax = plt.subplots(figsize=(12, 6))\n\n# Plot depth vs distance along the main axis\nsc = ax.scatter(distance_km, events_hypodd['DEPTH'], \n           c=events_hypodd['DEPTH'],\n           cmap='turbo_r',\n           s=80,\n           marker='o',\n           edgecolor='k',\n           linewidth=0.3,\n           alpha=0.2)\n\n# Add colorbar with shrink parameter to make it smaller\ncbar = plt.colorbar(sc, ax=ax, shrink=0.5)\ncbar.set_label('Depth (km)', fontsize=12, fontweight='bold')\n\n# Set labels and title\nax.set_xlabel('Distance along main axis (km)', fontsize=14, fontweight='bold')\nax.set_ylabel('Depth (km)', fontsize=14, fontweight='bold')\nax.set_title('Cross-section of Earthquake Events Along Principal Axis', fontsize=16)\n\n# Add grid\nax.grid(True, linestyle='-', linewidth=0.5, alpha=0.2, color='gray')\n\n# Adjust y-axis to show depth properly (negative values going down)\nax.invert_yaxis()\n\nplt.tight_layout()\nplt.show()\n\n# Print direction of main axis for reference\nmain_axis_vector = pca.components_[0]\nprint(f\"Main axis direction (LON, LAT): {main_axis_vector}\")\nprint(f\"Explained variance ratio: {pca.explained_variance_ratio_[0]:.2f}\")\nprint(f\"Total length of profile: {span_km:.2f} km\")","key":"lrTzMrnlY4"},{"type":"outputs","id":"qsyy05ka71B3bh8FDD_z9","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"00bdf631ba7ae9a37845b25bbd8d21fa","path":"/00bdf631ba7ae9a37845b25bbd8d21fa.png"},"text/plain":{"content":"<Figure size 1200x600 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"YypD3FXJz2"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Main axis direction (LON, LAT): [0.97499714 0.2222174 ]\nExplained variance ratio: 0.97\nTotal length of profile: 87.06 km\n"},"children":[],"key":"Bws4nMyWpG"}],"key":"RSIjPA6xvh"}],"key":"XBVUqyW6zH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from sklearn.decomposition import PCA\nimport numpy as np\n\n# Apply PCA to find the main axis of the earthquake cluster\n\n# Extract coordinates for PCA\ncoords = events_hypodd[['LON', 'LAT']].values\npca = PCA(n_components=2)\npca.fit(coords)\n\n# Project points onto the principal component\nprojected_points = pca.transform(coords)\n\n# Convert projected points to actual distance in km using a crude approximation\n# Scale factor: 1 degree ≈ 111.2 km\nkm_per_degree = 111.2\n\n# Calculate the min and max in the projected space for the second component (perpendicular to main axis)\nmin_proj2 = projected_points[:, 1].min()\nmax_proj2 = projected_points[:, 1].max()\n\n# Calculate the total span in original coordinates\nsecond_axis_vector = pca.components_[1]  # Vector direction of second axis (LON, LAT)\n\n# Calculate the span in degrees along the second principal axis\nspan_degrees2 = np.sqrt((second_axis_vector[0]**2 + second_axis_vector[1]**2)) * (max_proj2 - min_proj2)\n\n# Convert to kilometers\nspan_km2 = span_degrees2 * km_per_degree\n\n# Scale the projection to real distance in km\ndistance_km2 = (projected_points[:, 1] - min_proj2) * span_km2 / (max_proj2 - min_proj2)\n\n# Create a new figure for the cross-section plot\nfig, ax = plt.subplots(figsize=(12, 6))\n\n# Plot depth vs distance across the main axis\nsc = ax.scatter(distance_km2, events_hypodd['DEPTH'], \n           c=events_hypodd['DEPTH'],\n           cmap='turbo_r',\n           s=80,\n           marker='o',\n           edgecolor='k',\n           linewidth=0.3,\n           alpha=0.2)\n\n# Add colorbar with shrink parameter to make it smaller\ncbar = plt.colorbar(sc, ax=ax, shrink=0.5)\ncbar.set_label('Depth (km)', fontsize=12, fontweight='bold')\n\n# Set labels and title\nax.set_xlabel('Distance across fault (km)', fontsize=14, fontweight='bold')\nax.set_ylabel('Depth (km)', fontsize=14, fontweight='bold')\nax.set_title('Cross-fault Projection of Earthquake Events', fontsize=16)\n\n# Add grid\nax.grid(True, linestyle='-', linewidth=0.5, alpha=0.4, color='gray')\n\n# Adjust y-axis to show depth properly (negative values going down)\nax.invert_yaxis()\n\nplt.tight_layout()\nplt.show()\n\n# Print direction of main axis for reference\nmain_axis_vector = pca.components_[0]\nsecond_axis_vector = pca.components_[1]\nprint(f\"Main axis direction (LON, LAT): {main_axis_vector}\")\nprint(f\"Second axis direction (LON, LAT): {second_axis_vector}\")\nprint(f\"Explained variance ratio: {pca.explained_variance_ratio_[0]:.2f}\")\nprint(f\"Width of cross-fault profile: {span_km2:.2f} km\")","key":"xPkS5iUELq"},{"type":"outputs","id":"ZoqsuWgtZotGaAUsDC26z","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"a226b19cfb7d9d5bc66dc8227cd392b0","path":"/a226b19cfb7d9d5bc66dc8227cd392b0.png"},"text/plain":{"content":"<Figure size 1200x600 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"CcdYW1YY0G"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Main axis direction (LON, LAT): [0.97499714 0.2222174 ]\nSecond axis direction (LON, LAT): [-0.2222174   0.97499714]\nExplained variance ratio: 0.97\nWidth of cross-fault profile: 30.03 km\n"},"children":[],"key":"zCmXQhvIKo"}],"key":"K7d4GYsEAe"}],"key":"LnsRkX12yY"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now we are going to compare before and after relocation.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fhhiysxizP"}],"key":"iB4XATf3ie"}],"key":"q4jLTZrtLh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Read the original catalog for comparison\nevents_original = pd.read_csv('./HypoDD.loc', header=None, sep=\"\\s+\", \n                            names=['ID', 'LAT', 'LON', 'DEPTH', 'X', 'Y', 'Z', 'EX', 'EY', 'EZ', \n                                  'YR', 'MO', 'DY', 'HR', 'MI', 'SC', 'MAG', 'NCCP', 'NCCS', 'NCTP', \n                                  'NCTS', 'RCC', 'RCT', 'CID'])\n\n# Create a figure with 2x2 grid for comparing before and after\nfig = plt.figure(figsize=(15, 12))\ngs = fig.add_gridspec(2, 2, width_ratios=[1.5, 1])\n\n# Map view comparison (top-left)\nax1 = fig.add_subplot(gs[0, 0])\nax1.scatter(events_original['LON'], events_original['LAT'], c='blue', s=30, alpha=0.3, label='Original')\nax1.scatter(events_hypodd['LON'], events_hypodd['LAT'], c='red', s=30, alpha=0.3, label='HypoDD')\nax1.set_xlabel('Longitude (°)', fontsize=12)\nax1.set_ylabel('Latitude (°)', fontsize=12)\nax1.set_title('Map View: Original vs HypoDD', fontsize=14)\nax1.legend()\nax1.grid(True, linestyle='-', linewidth=0.5, alpha=0.4)\nax1.set_aspect('equal')\n\n# Depth cross-section along longitude (top-right)\nax2 = fig.add_subplot(gs[0, 1])\nax2.scatter(events_original['LON'], events_original['DEPTH'], c='blue', s=30, alpha=0.3, label='Original')\nax2.scatter(events_hypodd['LON'], events_hypodd['DEPTH'], c='red', s=30, alpha=0.3, label='HypoDD')\nax2.set_xlabel('Longitude (°)', fontsize=12)\nax2.set_ylabel('Depth (km)', fontsize=12)\nax2.set_title('Longitude vs Depth', fontsize=14)\nax2.legend()\nax2.grid(True, linestyle='-', linewidth=0.5, alpha=0.4)\nax2.invert_yaxis()  # Depths increase downward\n\n# Depth cross-section along latitude (bottom-left)\nax3 = fig.add_subplot(gs[1, 0])\nax3.scatter(events_original['LAT'], events_original['DEPTH'], c='blue', s=30, alpha=0.3, label='Original')\nax3.scatter(events_hypodd['LAT'], events_hypodd['DEPTH'], c='red', s=30, alpha=0.3, label='HypoDD')\nax3.set_xlabel('Latitude (°)', fontsize=12)\nax3.set_ylabel('Depth (km)', fontsize=12)\nax3.set_title('Latitude vs Depth', fontsize=14)\nax3.legend()\nax3.grid(True, linestyle='-', linewidth=0.5, alpha=0.4)\nax3.invert_yaxis()  # Depths increase downward\n\n# Depth histogram comparison (bottom-right)\nax4 = fig.add_subplot(gs[1, 1])\nax4.hist(events_original['DEPTH'], bins=20, alpha=0.5, color='blue', label='Original')\nax4.hist(events_hypodd['DEPTH'], bins=20, alpha=0.5, color='red', label='HypoDD')\nax4.set_xlabel('Depth (km)', fontsize=12)\nax4.set_ylabel('Count', fontsize=12)\nax4.set_title('Depth Distribution', fontsize=14)\nax4.legend()\nax4.grid(True, linestyle='-', linewidth=0.5, alpha=0.4)\n\nplt.tight_layout()\nplt.show()\n\n# Calculate and print some statistics about the differences\nprint(f\"Mean location changes:\")\nprint(f\"  Latitude: {(events_hypodd['LAT'] - events_original['LAT']).mean():.6f} degrees\")\nprint(f\"  Longitude: {(events_hypodd['LON'] - events_original['LON']).mean():.6f} degrees\")\nprint(f\"  Depth: {(events_hypodd['DEPTH'] - events_original['DEPTH']).mean():.2f} km\")\nprint(f\"Maximum location changes:\")\nprint(f\"  Latitude: {(events_hypodd['LAT'] - events_original['LAT']).abs().max():.6f} degrees\")\nprint(f\"  Longitude: {(events_hypodd['LON'] - events_original['LON']).abs().max():.6f} degrees\")\nprint(f\"  Depth: {(events_hypodd['DEPTH'] - events_original['DEPTH']).abs().max():.2f} km\")","key":"XZznb9myoK"},{"type":"outputs","id":"XMX2_LdK53nsnYE9h-AZg","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"8010eef70b199b924a2f56251eebeed5","path":"/8010eef70b199b924a2f56251eebeed5.png"},"text/plain":{"content":"<Figure size 1500x1200 with 4 Axes>","content_type":"text/plain"}}},"children":[],"key":"tiG5uEPDUK"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Mean location changes:\n  Latitude: -0.001978 degrees\n  Longitude: -0.001164 degrees\n  Depth: -0.39 km\nMaximum location changes:\n  Latitude: 0.300660 degrees\n  Longitude: 0.726135 degrees\n  Depth: 19.54 km\n"},"children":[],"key":"R3eNvmHZGe"}],"key":"p16hqYycRU"}],"key":"RpnsanYJAx"}],"key":"PM5rnZakIR"},"references":{"cite":{"order":[],"data":{}}}}