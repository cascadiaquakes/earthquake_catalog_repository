{"version":3,"kind":"Notebook","sha256":"db904432a1ab80b3792f22f8fb8535936ac5b73b50a63bbf06120b9e6149ec2c","slug":"conv-plots","location":"/notebooks/Loic/conv_plots.ipynb","dependencies":[],"frontmatter":{"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"id":"Amanda M. Thomas, William Marfo, and Loïc Bachelot","name":"Amanda M. Thomas, William Marfo, and Loïc Bachelot"}],"keywords":["earthquake","catalog","ML","AI"],"numbering":{"title":{"offset":2}},"exports":[{"format":"ipynb","filename":"conv_plots.ipynb","url":"/conv_plots-cd12dfc07a3882d81a90bc73fe915a7b.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\nfrom matplotlib.animation import FuncAnimation, PillowWriter","key":"f0HeAnvqBO"},{"type":"outputs","id":"cKpikXVMEKxXzVgyPxa5F","children":[],"key":"yybGOcdABb"}],"key":"B5W0KTgASF"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Create the input signal\nsignal = np.zeros(100)\nsignal[10:20] = 1\nsignal[40:50] = 2\nsignal[70:75] = -1\n\n# Define the convolution kernel\nkernel = np.array([1, 0, -1])\nk_size = len(kernel)\n\n# Pad signal for 'valid' convolution (you can switch to 'same' or 'full' mode if needed)\npad = k_size // 2\npadded_signal = np.pad(signal, (pad, pad), mode='constant', constant_values=0)\noutput = np.zeros_like(signal)\n\n# Set up the plot\nfig, (ax_signal, ax_output) = plt.subplots(2, 1, figsize=(15, 5), sharex=True)\n\nax_signal.set_title(\"Signal\")\nline_signal, = ax_signal.plot(signal, color='blue')\nkernel_window, = ax_signal.plot([], [], color='red', lw=5)\nkernel_box = ax_signal.fill_between([], [], [], color='red', alpha=0.2)\n\nax_output.set_title(\"Convolution Output\")\nline_output, = ax_output.plot(np.zeros_like(signal), color='orange')\n\n# Formatting\nax_signal.set_ylim(signal.min() - 1, signal.max() + 1)\nax_output.set_ylim(signal.min() - 2, signal.max() + 1)\n\ndef init():\n    kernel_window.set_data([], [])\n    line_output.set_ydata(np.zeros_like(signal))\n    return kernel_window, line_output\n\ndef update(i):\n    start = i\n    end = i + k_size\n    if end > len(padded_signal):\n        return kernel_window, line_output\n\n    window = padded_signal[start:end]\n    conv_val = np.dot(kernel, window)\n\n    # Update kernel overlay\n    x_vals = np.arange(start - pad, end - pad)\n    y_vals = window\n    kernel_window.set_data(x_vals, y_vals)\n\n    # Update output value\n    output[i] = conv_val\n    line_output.set_ydata(output)\n\n    return kernel_window, line_output\n\n# Create the animation\nani = FuncAnimation(fig, update, frames=len(signal), init_func=init, blit=True, interval=100)\n\n# Save as GIF\nani.save(\"conv1d_demo.gif\", writer=PillowWriter(fps=10))","key":"tBViqlgOAT"},{"type":"outputs","id":"rWvmvWXGjL9Huttk8rHEe","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"c115552dbeb6a277fe47c9b9d4dca86e","path":"/c115552dbeb6a277fe47c9b9d4dca86e.png"},"text/plain":{"content":"<Figure size 1500x500 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"YPN8PNWYIO"}],"key":"PiXTmXfTS0"}],"key":"v2hk7Rr6zd"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# ReLU and Max Pooling (in case not already defined)\ndef relu(x):\n    return np.maximum(0, x)\n\ndef max_pool1d_np(x, kernel_size=2):\n    stride = kernel_size\n    L = len(x)\n    out_len = (L - kernel_size) // stride + 1\n    return np.array([np.max(x[i*stride : i*stride + kernel_size]) for i in range(out_len)])\n\n# Apply operations\nrelu_output = relu(output)\npooled_output = max_pool1d_np(relu_output, kernel_size=2)\n\n# X positions for pooled values (centered in their window)\npooled_x = np.arange(0, len(pooled_output))\n\n# Plot\nfig, (ax1, ax2) = plt.subplots(2, 1, figsize=(15, 5), sharex=False)\n\n# --- ReLU plot ---\nax1.set_title(\"ReLU Applied to Convolution Output\")\nax1.plot(np.arange(len(relu_output)), relu_output, color='green')\nax1.set_xlim(0, len(relu_output))\nax1.set_ylabel(\"ReLU(conv)\")\nax1.set_xlabel(\"Position (0 to 100)\")\n\n# --- Max Pooling plot ---\nax2.set_title(\"Max Pooling Result (kernel=2)\")\nax2.plot(pooled_x, pooled_output, color='purple', linestyle='-')\nax2.set_xlim(0, 50)\nax2.set_xlabel(\"Reduced Output Positions\")\nax2.set_ylabel(\"Pooled Value\")\n\n# Adjust width of ax2 to 50% of ax1\npos1 = ax1.get_position()\npos2 = ax2.get_position()\n\n# Shrink ax2 width to 50% and align it to the center of ax1\nnew_width = pos1.width * 0.5\nax2.set_position([\n    pos1.x0 + (pos1.width - new_width) / 2,  # center it\n    pos2.y0-0.1,\n    new_width,\n    pos2.height\n])\nplt.savefig(\"./ReLU_pooling.png\", bbox_inches='tight', dpi=200)\n# plt.tight_layout()\nplt.show()","key":"ghLX76y9Pj"},{"type":"outputs","id":"05Sey6RXZR34i3n42CvF5","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"4d71bd962a2cdee7dd608f7fac757a44","path":"/4d71bd962a2cdee7dd608f7fac757a44.png"},"text/plain":{"content":"<Figure size 1500x500 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"x78sOcgqrm"}],"key":"yKvK0Us8os"}],"key":"bl2TyQVC4s"}],"key":"ihD7V0iq7a"},"references":{"cite":{"order":[],"data":{}}}}