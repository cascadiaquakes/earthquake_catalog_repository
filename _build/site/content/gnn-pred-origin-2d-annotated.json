{"version":3,"kind":"Notebook","sha256":"503ca55273b21a8213b04bb1d28bea79332a63d198510dac796d35697c4e5409","slug":"gnn-pred-origin-2d-annotated","location":"/notebooks/Loic/GNN/GNN_pred_origin_2d_annotated.ipynb","dependencies":[],"frontmatter":{"title":"üåê Predicting Earthquake Origins with Graph Neural Networks","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"id":"Amanda M. Thomas, William Marfo, and Lo√Øc Bachelot","name":"Amanda M. Thomas, William Marfo, and Lo√Øc Bachelot"}],"keywords":["earthquake","catalog","ML","AI"],"numbering":{"title":{"offset":3}},"exports":[{"format":"ipynb","filename":"GNN_pred_origin_2d_annotated.ipynb","url":"/GNN_pred_origin_2d_a-4f5edd63a8ca5a782fbb7f964aea1b0c.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Author:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fZFEZCR0yA"}],"key":"zszx1d7nt7"},{"type":"text","value":" Lo√Øc Bachelot","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JZjveAd48N"},{"type":"break","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hZGffkSk0F"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Goal:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"iFG6rbFtTw"}],"key":"kYaOVoo8ML"},{"type":"text","value":" This notebook demonstrates how to use a GNN to predict the 2D spatial origin of synthetic seismic events from graph-structured input data.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nzn8g7b5wQ"}],"key":"KMNuJ24pxI"},{"type":"thematicBreak","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"ELrnPh5oZW"},{"type":"heading","depth":2,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"üìò Overview","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"WMtoLiyZhh"}],"identifier":"id-overview","label":"üìò Overview","html_id":"id-overview","implicit":true,"key":"saVLDr0wnu"},{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Seismic events recorded across a geographic area generate time series data at multiple stations. To model the origin of these events:","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"Q8lXhWB2fG"}],"key":"wudGpYcdjP"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":12,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"We treat each seismic station as a ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"YGAqIbh842"},{"type":"strong","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"node","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"aPXyiMwei1"}],"key":"VU16QkOYcT"},{"type":"text","value":" in a graph.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"sZfFh33xs2"}],"key":"jyA4mQoVPR"}],"key":"UUeWerlPia"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"j0KkpIc2ok"},{"type":"strong","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"edges","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"CP5LZOH5p1"}],"key":"BByuqAgDEd"},{"type":"text","value":" represent relationships (e.g., geographic proximity).","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"tkyqsA3JQL"}],"key":"W8Z580mpGx"}],"key":"sVGHdWmZsy"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"n7CFrG1oWK"},{"type":"strong","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"features","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"my8zqQDame"}],"key":"WPLYqhMP9j"},{"type":"text","value":" include both the station‚Äôs location and the recorded signals.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"k6HKYI0Res"}],"key":"ZhFiLAL9gn"}],"key":"Txe34oVTWC"}],"key":"VQCT5XcDmD"},{"type":"paragraph","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"We‚Äôll walk through:","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"F8aSC4Wz93"}],"key":"SRjp3QwdcX"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":17,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Creating synthetic data and graph structures","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"cs1gHFL6jv"}],"key":"xgwrQ04vwK"}],"key":"lpewUySJLn"},{"type":"listItem","spread":true,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Building a GNN model (with attention-based pooling)","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"YVau7BzA13"}],"key":"VG6Szw8M1J"}],"key":"yg6kEsrWXv"},{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Training and evaluating the model","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"D5xJ3T8I4g"}],"key":"dNZ4t8jnJL"}],"key":"vEKYFg1Jyg"},{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Visualizing predictions","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"x6UOiUutWz"}],"key":"otB1xidAUc"}],"key":"XYp2s7EQmL"}],"key":"EP47VHzSuZ"}],"key":"u6SJxdsjdH"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"üì¶ Imports and Setup","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RB0WzZ54YV"}],"identifier":"id-imports-and-setup","label":"üì¶ Imports and Setup","html_id":"id-imports-and-setup","implicit":true,"key":"n2TyBIUodN"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"We import PyTorch, PyTorch Geometric, and helper libraries used to build and train the GNN.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"PB2pYcjUcS"}],"key":"EiDNL9aysw"}],"key":"C3Aw0atVx2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import torch\nimport torch_geometric\nprint(torch.__version__)\nprint(torch_geometric.__version__)","key":"cpnglg3Sfo"},{"type":"outputs","id":"Tj9jagPkMiDBmWPWRwTv4","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"2.6.0+cu124\n2.6.1\n"},"children":[],"key":"QPXpkId0um"}],"key":"w4TGiDOQ9d"}],"key":"hEM1wSUgkZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%pip install pyg_lib torch_scatter torch_sparse torch_cluster torch_spline_conv -f https://data.pyg.org/whl/torch-2.6.0+cu124.html","key":"cHRWPB8Wwb"},{"type":"outputs","id":"RvVWCz5jq0ZSQ4yy0w26z","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Looking in links: https://data.pyg.org/whl/torch-2.6.0+cu124.html\nRequirement already satisfied: pyg_lib in /srv/conda/envs/notebook/lib/python3.12/site-packages (0.4.0+pt26cu124)\nRequirement already satisfied: torch_scatter in /srv/conda/envs/notebook/lib/python3.12/site-packages (2.1.2+pt26cu124)\nRequirement already satisfied: torch_sparse in /srv/conda/envs/notebook/lib/python3.12/site-packages (0.6.18+pt26cu124)\nRequirement already satisfied: torch_cluster in /srv/conda/envs/notebook/lib/python3.12/site-packages (1.6.3+pt26cu124)\nRequirement already satisfied: torch_spline_conv in /srv/conda/envs/notebook/lib/python3.12/site-packages (1.2.2+pt26cu124)\nRequirement already satisfied: scipy in /srv/conda/envs/notebook/lib/python3.12/site-packages (from torch_sparse) (1.15.1)\nRequirement already satisfied: numpy<2.5,>=1.23.5 in /srv/conda/envs/notebook/lib/python3.12/site-packages (from scipy->torch_sparse) (1.26.4)\nNote: you may need to restart the kernel to use updated packages.\n"},"children":[],"key":"q5PuXwJEcm"}],"key":"hleB8ELMBy"}],"key":"WYojZI6Io3"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\nfrom torch_geometric.data import Data\nimport torch\nimport torch_geometric\nfrom torch_geometric.transforms import KNNGraph\nfrom torch_geometric.data import InMemoryDataset, Data\nfrom torch.nn import Linear, Parameter, LeakyReLU, Conv2d, MaxPool1d\nfrom torch_geometric.nn import GCNConv, MessagePassing, MLP, GATv2Conv, global_mean_pool, GlobalAttention\nfrom scipy.spatial import distance\nfrom torch_geometric.utils import add_self_loops, degree\nfrom tqdm import tqdm\nfrom torch import nn\nimport time\nimport os","key":"hYSkyZnJuJ"},{"type":"outputs","id":"Lfm-apd-oyAEc6o-84MJE","children":[],"key":"Lh1Ks1TLyH"}],"key":"jvKFFtXzBS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(torch.__version__)","key":"jCKd3HuKGs"},{"type":"outputs","id":"Qj0P2giVm-5q-ru469uZ5","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"2.6.0+cu124\n"},"children":[],"key":"ccXchggXr0"}],"key":"OMqnwuOZ3P"}],"key":"XP0oR50FDB"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"üñºÔ∏è Visualization Helper Functions","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cu85BTS5Fz"}],"identifier":"id-visualization-helper-functions","label":"üñºÔ∏è Visualization Helper Functions","html_id":"id-visualization-helper-functions","implicit":true,"key":"FukAOm13BK"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"To better understand the structure of the input graphs and the behavior of the signal data, we define two visualization utilities:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"tKBfOE2b3y"}],"key":"GrNiu9YZw7"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"inlineCode","value":"visualize_graph_torch","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"lPGmmR71Rh"}],"key":"NtESpCDVEz"},{"type":"break","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"UcAXkpu78k"},{"type":"text","value":"This function draws the graph in 2D space:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"BNnZjOLMnv"}],"key":"TvrD0ItiMn"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Nodes are colored based on a given feature (e.g., signal amplitude or attention score).","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"mbcDMXqxmF"}],"key":"ypZkI3jwTH"}],"key":"WY42BkUV7w"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Edges are shown as lines connecting nodes.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"Jaq3nB3rlg"}],"key":"FWsdFxXyLu"}],"key":"aTPKagBcWL"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The true event origin is marked with a red ‚ùå.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"MJEzgll6z5"}],"key":"Cq2NNRMEPl"}],"key":"cn8sbFqXuv"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"If predictions are available, the model‚Äôs estimated origin is shown with a blue ‚ùå.","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"bHgpTLnGwk"}],"key":"bTuwvAHNlq"}],"key":"BaOEQlxsYh"}],"key":"PRfL6VlS71"}],"key":"L36zCJrmrL"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"strong","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"inlineCode","value":"plot_signals_subplots_by_distance","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"w13efxOy6D"}],"key":"e8jmIy9zsJ"},{"type":"break","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"TNYwRRSG8M"},{"type":"text","value":"This function plots the signal recorded at each station in a separate subplot:","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"KO7qVzm5zj"}],"key":"M9ZZN3C3n5"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":14,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Subplots are ordered by the station‚Äôs distance from the origin.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"oc7LJy2FWG"}],"key":"Mvij8OxAgE"}],"key":"Hp8Wt4CRKx"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"A red dashed line indicates the expected arrival time of the wave.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"zdU1lY4Ep9"}],"key":"TJB1He5Cpa"}],"key":"kN6oecxg0C"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"This helps assess whether the signal aligns with physical expectations.","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"zq5qT3Mdtf"}],"key":"JtxJSAn396"}],"key":"CZ5X4cWPvg"}],"key":"a6QLvc6y72"}],"key":"eWghlHgzyl"}],"key":"OuUzz71nV6"}],"key":"jyKrZq1xaR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def visualize_graph_torch(g, color, pred=False, ax=None, title=None):\n    \"\"\"\n    Visualize the graph structure with PyTorch Geometric graph object.\n\n    Args:\n        g (Data): Graph data object with edge_index, pos, and feature color\n        color (str): Node attribute key to use for coloring\n        pred (bool): If True, also plot predicted origin with blue cross\n        ax (matplotlib.axes.Axes, optional): If provided, draw into this axis\n        title (str, optional): Optional title to display above plot\n\n    Behavior:\n    - Nodes are colored by the specified feature (e.g., signal or attention score)\n    - Edges are drawn in blue\n    - True origin marked with red ‚ùå\n    - Prediction (if enabled) marked with blue ‚ùå\n    \"\"\"\n    created_fig = False\n    if ax is None:\n        fig, ax = plt.subplots(figsize=(6, 6))\n        created_fig = True\n\n    # Plot edges\n    for edge in g.edge_index.T:\n        ax.plot(\n            [g.pos[edge[0]][0], g.pos[edge[1]][0]],\n            [g.pos[edge[0]][1], g.pos[edge[1]][1]],\n            color='blue', linewidth=1\n        )\n\n    # Node scatter with color\n    scatter = ax.scatter(\n        x=g.pos.T[0],\n        y=g.pos.T[1],\n        alpha=1,\n        c=g[color][:, 0],\n        s=150\n    )\n\n    # True origin\n    if hasattr(g, 'y') and g.y[0].numel() == 2:\n        ax.plot(g.y[0][0], g.y[0][1], 'rx', markersize=12, markeredgewidth=3)\n\n    # Predicted origin\n    if pred and hasattr(g, 'pred') and g.pred[0].numel() == 2:\n        ax.plot(g.pred[0][0], g.pred[0][1], 'bx', markersize=12, markeredgewidth=3)\n\n    # Title if given\n    if title:\n        ax.set_title(title)\n\n    # Clean axes\n    ax.set_xticks([])\n    ax.set_yticks([])\n\n    # Legend for coloring only once if top-level figure\n    if created_fig:\n        legend1 = ax.legend(*scatter.legend_elements(), loc='center left', bbox_to_anchor=(1, 0.5))\n        ax.add_artist(legend1)\n        plt.show()\n\n\ndef plot_signals_subplots_by_distance(data, velocity=0.5, sampling_rate=1.0, title=\"Signals by distance to origin\"):\n    \"\"\"\n    Plot each station's signal in its own subplot, ordered by distance to origin,\n    with vertical lines showing the arrival time of the wavefront.\n\n    Args:\n        data (Data): PyG Data object with:\n            - pos: [num_nodes, 2]\n            - signal: [num_nodes, SIGNAL_SIZE]\n            - y: [1, 2] or [2] for origin location\n        velocity (float): Wave propagation speed (units per second)\n        sampling_rate (float): Sample rate (Hz)\n        title (str): Title of the figure\n    \"\"\"\n    pos = data.pos.cpu().numpy()\n    signals = data.signal.cpu().numpy()\n    origin = data.y.squeeze().cpu().numpy()\n\n    num_nodes = pos.shape[0]\n\n    # Compute distances from origin and convert to sample index\n    distances = np.array([distance.euclidean(origin, pos[i].tolist()) for i in range(num_nodes)])\n    arrival_samples = (distances / velocity * sampling_rate).astype(int)\n    sort_idx = np.argsort(distances)\n\n    # Plot one subplot per station\n    fig, axs = plt.subplots(num_nodes, 1, figsize=(10, 2 * num_nodes), sharex=True)\n    for i, idx in enumerate(sort_idx):\n        ax = axs[i]\n        signal = signals[idx]\n\n        ax.plot(np.arange(len(signal)), signal, color='black', linewidth=1)\n        ax.axvline(arrival_samples[idx], color='red', linestyle='--', linewidth=1, label='arrival')\n        ax.set_ylabel(f\"{distances[idx]:.2f}\", rotation=0, labelpad=25)\n        ax.grid(True, linestyle='--', alpha=0.3)\n\n    axs[-1].set_xlabel(\"Time (samples)\")\n    fig.suptitle(title, fontsize=14)\n    plt.tight_layout(rect=[0, 0, 1, 0.98])\n    plt.show()","key":"bwWUYgyX2U"},{"type":"outputs","id":"eLb1EMSRyuetLKLo6_jMg","children":[],"key":"cdriXPki3p"}],"key":"nC19tC4Cks"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"üìà Synthetic Dataset Creation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JsiqbXOVqy"}],"identifier":"id-synthetic-dataset-creation","label":"üìà Synthetic Dataset Creation","html_id":"id-synthetic-dataset-creation","implicit":true,"key":"qJm4lINzqH"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We simulate synthetic graph-based seismic data to train our Graph Neural Network (GNN). Each graph represents a seismic network where:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fOP1IUklA7"}],"key":"jHVzNW29UQ"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Nodes","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"d4bHR0XiNq"}],"key":"UqWxFotxj9"},{"type":"text","value":" are seismic stations with 2D spatial coordinates.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ogl6Eemv6W"}],"key":"XXDZ2yxfN7"}],"key":"EfAr0dYdf3"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Edges","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"qWFb0gJBF7"}],"key":"MuRDpWDrDT"},{"type":"text","value":" are created later based on k-nearest neighbors or distance.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"wruFdsaqX4"}],"key":"iwXferKeaa"}],"key":"iTT0bc3aKb"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Signals","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"JqUoimayA1"}],"key":"lXI4ppoLPz"},{"type":"text","value":" at each station are generated as noisy sine waves, delayed in time based on the distance to a hidden origin (the earthquake location).","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"TDWiZclLCi"}],"key":"SHsB11HDJj"}],"key":"Ci3vWI4FUi"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"The target (","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"PgdFUag8H5"},{"type":"inlineCode","value":"y","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"zLCMhQTsZ1"},{"type":"text","value":")","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"BJyOpp1usf"}],"key":"x2uxDhQdVm"},{"type":"text","value":" for each graph is the 2D coordinate of the origin ‚Äî the same for all nodes.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"DwP7ywN0uH"}],"key":"kFEDEXaUqD"}],"key":"HqaXpPAeYT"}],"key":"bdkJeuCswn"},{"type":"heading","depth":3,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"üß™ Signal Generation Parameters:","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"BskDGs22Ar"}],"identifier":"id-signal-generation-parameters","label":"üß™ Signal Generation Parameters:","html_id":"id-signal-generation-parameters","implicit":true,"key":"jVOgtdxAql"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":11,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"inlineCode","value":"nb_nodes ‚àà [10, 15]","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"kTp1nWfSBt"}],"key":"UxjiWfC79E"},{"type":"text","value":": Number of seismic stations per graph.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"VovhIMswZy"}],"key":"wbJn5sd7tB"}],"key":"xCegSvD0sn"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"inlineCode","value":"origin ‚àà [0, 6]¬≤","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"ln5T4SAHR9"}],"key":"Omc5j5crqt"},{"type":"text","value":": The true epicenter is sampled randomly in a 6√ó6 unit grid.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"OdY9SnXENY"}],"key":"Q8lhOxNNDP"}],"key":"StEUBQbyrH"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"inlineCode","value":"velocity = 0.5 units/sec","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"uzwq22mQqG"}],"key":"RXc4xp6Ped"},{"type":"text","value":": Controls how fast the signal propagates from the origin.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"CY3SaBruRM"}],"key":"GB0vybelsN"}],"key":"ip0o8t24vU"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"inlineCode","value":"sampling_rate = 1.0 Hz","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"rV6syYtVcu"}],"key":"VV4RgSnSzh"},{"type":"text","value":": Defines the number of samples per unit of time.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"BUdEg65Tv6"}],"key":"tcEWC2HzqF"}],"key":"QDkFNlWQVT"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"inlineCode","value":"noise_std = 0.1","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"J6zbPn77I2"}],"key":"CdmTAinzFJ"},{"type":"text","value":": Gaussian noise is added to simulate real-world signal variation.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"X5xAnPdhd1"}],"key":"z4XfGhRls6"}],"key":"vMCS0usDFZ"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"inlineCode","value":"SIGNAL_SIZE","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"GBZdcGYbtH"}],"key":"g72NVTRFd2"},{"type":"text","value":": Total number of samples in the signal window (e.g., 100).","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"udfflrSo8q"}],"key":"s3NvpZ1hB1"}],"key":"z6azWaB10v"}],"key":"BdTGg7KX66"},{"type":"heading","depth":3,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"üåÄ How are signals delayed?","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"HnKkmgqu95"}],"identifier":"id-how-are-signals-delayed","label":"üåÄ How are signals delayed?","html_id":"id-how-are-signals-delayed","implicit":true,"key":"EX4qChwDZY"},{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"The signal at each node starts with random noise. Then:","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"NQUwkLTuBl"}],"key":"fQwoMyVDH6"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":20,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The time delay is computed as ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"Mek2l4ZGH0"},{"type":"inlineCode","value":"distance / velocity","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"Byu1Yp0Hbe"}],"key":"JNmaI9qnyc"}],"key":"noDddnat3v"},{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Converted to a sample index: ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"ooogi1GKG3"},{"type":"inlineCode","value":"delay_samples = delay * sampling_rate","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"ithaSp701C"}],"key":"WrXssJMGzh"}],"key":"ge5T0MELql"},{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"A sine wave is inserted at this delayed position in the signal","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"fTQmHpyFxz"}],"key":"FjwyQv4LG3"}],"key":"vfp6BMktiX"}],"key":"dhdZXIBsjI"},{"type":"paragraph","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"This creates a physically intuitive training signal: stations farther from the source receive the waveform later in time.","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"frNQcGXFM3"}],"key":"zj2F7ytGmA"},{"type":"paragraph","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"This setup allows the GNN to learn to ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"zoWUS5sZi9"},{"type":"strong","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"infer the origin coordinates","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"Esam3QSiQW"}],"key":"XY9O2F5V3p"},{"type":"text","value":" purely from the spatial pattern of waveform arrivals and features across nodes.","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"qDEIifrH4b"}],"key":"gHtYtQy3GF"}],"key":"i4mzsTMiaZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def add_edge_weight(g):\n    \"\"\"\n    Compute edge weights based on inverse distance between nodes.\n\n    This function adds an 'edge_weight' attribute to each graph,\n    calculated as 1 / (distance + 1) to ensure numerical stability.\n\n    Args:\n        g (Data): PyG graph with 'pos' and 'edge_index'\n\n    Returns:\n        Data: Modified graph with 'edge_weight'\n    \"\"\"\n    edge_weight = []\n    for edge in g.edge_index.T:\n        node_a, node_b = g.pos[edge[0]], g.pos[edge[1]]\n        dist = distance.euclidean((node_a[0], node_a[1]), (node_b[0], node_b[1]))\n        edge_weight.append(1 / (dist + 1))  # add 1 to avoid division by zero\n    g.edge_weight = torch.tensor(np.array(edge_weight)).type(torch.FloatTensor)\n    return g\n\n\nclass SinOriginDataset(InMemoryDataset):\n    \"\"\"\n    Synthetic dataset for training GNNs to predict origin locations.\n\n    Each graph in the dataset includes:\n    - Randomly placed nodes in 2D space.\n    - Sine wave signals at each node, delayed by distance from a hidden origin.\n    - A regression target: the origin coordinates.\n\n    Args:\n        root (str): Root directory to save the processed data\n        nb_graph (int): Number of synthetic graphs to generate\n    \"\"\"\n    def __init__(self, root, transform=None, pre_transform=None, nb_graph=10):\n        self.nb_graph = nb_graph\n        super(SinOriginDataset, self).__init__(root, transform, pre_transform)\n        self.data, self.slices = torch.load(self.processed_paths[0], weights_only=False)\n\n    @property\n    def raw_file_names(self):\n        # No raw input files; data is generated from scratch\n        return 0\n\n    @property\n    def processed_file_names(self):\n        return 'data.pt'\n\n    def process(self):\n        data_list = []\n\n        # Dataset parameters\n        frequency = 1.0        # Hz\n        velocity = 0.5         # wave speed\n        sampling_rate = 1.0    # Hz\n        noise_std = 0.1        # Gaussian noise level\n\n        # Base sine wave used in signal synthesis\n        base_sine_wave = np.sin(np.arange(SIGNAL_SIZE))\n\n        for _ in range(self.nb_graph):\n            nb_nodes = np.random.randint(10, 15)  # Graph size\n            pos = torch.tensor(np.random.uniform(0, 6, size=(nb_nodes, 2)), dtype=torch.float)  # Node positions\n            origin = np.random.randint(0, 6, size=2)  # True origin\n            origin_tensor = torch.tensor(origin, dtype=torch.float)\n\n            signal_list = []\n            for i in range(nb_nodes):\n                dist = distance.euclidean(origin, pos[i].tolist())\n                delay = dist / velocity\n                delay_samples = int(delay * sampling_rate)\n\n                # Start with noise\n                waveform = np.random.normal(0, noise_std, size=SIGNAL_SIZE)\n\n                # Add delayed sine wave if within bounds\n                if delay_samples < SIGNAL_SIZE:\n                    insert_length = SIGNAL_SIZE - delay_samples\n                    waveform[delay_samples:] += base_sine_wave[:insert_length]\n\n                signal_list.append(waveform)\n\n            signal = torch.tensor(np.array(signal_list), dtype=torch.float32).reshape(nb_nodes, SIGNAL_SIZE)\n            g = Data(pos=pos, signal=signal, y=origin_tensor.unsqueeze(0))  # y shape: (1, 2)\n            data_list.append(g)\n\n        # Apply graph transformations if provided (e.g., KNN, edge weights)\n        if self.pre_transform is not None:\n            data_list = [self.pre_transform(data) for data in data_list]\n            data_list = [add_edge_weight(data) for data in data_list]\n\n        # Save to disk\n        data, slices = self.collate(data_list)\n        torch.save((data, slices), self.processed_paths[0])","key":"h4OafjQbaz"},{"type":"outputs","id":"_WytglqZwpwPck5D_X64Q","children":[],"key":"ar43uKzSp9"}],"key":"CP4ajEzuQw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"SIGNAL_SIZE = 20\nNB_GRAPHS = 1000\n\nraw_dataset = SinOriginDataset(root=\"./sin_train\", pre_transform=KNNGraph(k=5, loop=False, force_undirected=True), \n                       nb_graph=NB_GRAPHS)\nraw_dataset","key":"wUZvHkqrTe"},{"type":"outputs","id":"pHRZUEMUKX6FOJjqPJ91T","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":7,"metadata":{},"data":{"text/plain":{"content":"SinOriginDataset(1000)","content_type":"text/plain"}}},"children":[],"key":"kIIZXLOKEP"}],"key":"HdarrQhsnt"}],"key":"y6XBFJ4ddZ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"üîç Exploring a Graph Sample","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WmgFTHgnVX"}],"identifier":"id-exploring-a-graph-sample","label":"üîç Exploring a Graph Sample","html_id":"id-exploring-a-graph-sample","implicit":true,"key":"RxqNxIS4sJ"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Let‚Äôs take a look at one sample from our synthetic dataset to understand its structure.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"kaPSAeTPKg"}],"key":"RH42Ro68sP"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"PyTorch Geometric stores each graph in a ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"V7tpj0Xf8I"},{"type":"inlineCode","value":"Data","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"JBcaB7zOS7"},{"type":"text","value":" object. Here‚Äôs what each attribute means:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"A0QIdS29kM"}],"key":"Q8J6pSLeUa"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"inlineCode","value":"y=[1, 2]","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"STm1QuCcix"}],"key":"WzZHTO08AM"},{"type":"text","value":": The target ‚Äî the 2D coordinates of the true origin (shared by all nodes in the graph).","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"XqxTcX791T"}],"key":"mYgm3MbbNp"}],"key":"kWfkftdzZF"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"inlineCode","value":"pos=[13, 2]","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"HEqJmurQKS"}],"key":"t2mZL6jER7"},{"type":"text","value":": The 2D spatial positions of 13 nodes (i.e., seismic stations).","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"w0Cl09AssF"}],"key":"JZgqCiXZZa"}],"key":"DcvG0m6tWl"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"inlineCode","value":"signal=[13, 20]","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"muSdPPPSMB"}],"key":"UTgtc89Fmw"},{"type":"text","value":": Each node has a 1D signal of length 20 (e.g., amplitude over time).","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"RDAte91uSE"}],"key":"r6xEtFTeiN"}],"key":"fgwM0eiHy9"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"inlineCode","value":"edge_index=[2, 74]","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"Ab8SrELGBH"}],"key":"LJGJ0SpqWa"},{"type":"text","value":": The graph has 74 directed edges represented as source/target pairs.","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"Ojd1N3Dgvt"}],"key":"iXc4G59uoA"}],"key":"aQKdLrZ9kS"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"inlineCode","value":"edge_weight=[74]","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"Uzk71LB203"}],"key":"cBwAGfPBFo"},{"type":"text","value":": Weights for each edge, inversely proportional to spatial distance.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"Tky8DQeJu7"}],"key":"AWTUBteuxj"}],"key":"Im9xOdp7Re"}],"key":"Nl7cuyBsa4"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"This compact format allows the GNN to process signals in a way that respects the spatial relationships between nodes.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"veJjHHsx8D"}],"key":"k1GiDb4CiA"}],"key":"rUUpLo8l6w"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"data = raw_dataset[0]\ndata","key":"S6rSORlDki"},{"type":"outputs","id":"7S43gWc4D5nDcMGAKDCMi","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":8,"metadata":{},"data":{"text/plain":{"content":"Data(y=[1, 2], pos=[14, 2], signal=[14, 20], edge_index=[2, 84], edge_weight=[84])","content_type":"text/plain"}}},"children":[],"key":"Rv6efPcTln"}],"key":"GU9am1VQzC"}],"key":"rz3s6dFkMW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"visualize_graph_torch(data, color='signal')","key":"xumqW98sPZ"},{"type":"outputs","id":"wO-GwauvZZwL66zJeHEhl","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"f175810cd3dc5937a50d562426893c16","path":"/f175810cd3dc5937a50d562426893c16.png"},"text/plain":{"content":"<Figure size 600x600 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"y2gKa3pcb5"}],"key":"KZV7W4f83L"}],"key":"lIyPpyGFaC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plot_signals_subplots_by_distance(data)","key":"bAb97VaDUC"},{"type":"outputs","id":"t-TVr9LpctO1Q55sBbaaH","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"aefd7c7eef85f5878ffcb927b10d4f93","path":"/aefd7c7eef85f5878ffcb927b10d4f93.png"},"text/plain":{"content":"<Figure size 1000x2800 with 14 Axes>","content_type":"text/plain"}}},"children":[],"key":"YiICAePVWb"}],"key":"RscGUEmirq"}],"key":"GShikQSAWl"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"üîÑ Target Normalization","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bDN6PAvk6d"}],"identifier":"id-target-normalization","label":"üîÑ Target Normalization","html_id":"id-target-normalization","implicit":true,"key":"EyCKgMBN4K"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Before training the model, we normalize the target coordinates (i.e., the true origin) to fall within a standard range.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"MHDVe8B8EH"}],"key":"xkvm2MkLyj"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"This is a common preprocessing step in regression problems, especially when using neural networks, because:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"qAFKf7tsNs"}],"key":"NTdyXdXSg4"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":6,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"It helps with training stability and convergence.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"xuTsoZDNsL"}],"key":"g7i1qdolJ3"}],"key":"v7NkF5kpOc"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Activations remain within consistent ranges.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"AFOBrWwZ42"}],"key":"Q0aYiaw5ot"}],"key":"x4tssvXnvC"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The network doesn‚Äôt need to ‚Äúlearn‚Äù scale information from scratch.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"cWlS8IYUxc"}],"key":"YHGDuUbnXl"}],"key":"QagRzeyYCi"}],"key":"ydJejiui36"},{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"We define a wrapper class ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"M4Dgwbfqhz"},{"type":"inlineCode","value":"NormalizeTargetsWrapper","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"OnQoNLwnan"},{"type":"text","value":" that rescales the target ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"vCPgTYWitU"},{"type":"inlineCode","value":"y","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"PzZ34fCMNF"},{"type":"text","value":" values from their original coordinate bounds (e.g., [0, 6]) to the range ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"iEg0FHEIFp"},{"type":"strong","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"[-1, 1]","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"qEoP4wD7xt"}],"key":"Mm1zyfug62"},{"type":"text","value":". This normalized range works well with activation functions like ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"VNBZYktouQ"},{"type":"inlineCode","value":"tanh","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"iIOE9qwJDK"},{"type":"text","value":".","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"wrB9yQiVoJ"}],"key":"SRGNA2JlTT"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"The class also includes a ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"oQXaY46qNm"},{"type":"inlineCode","value":"denormalize()","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"iBfFmIuhmo"},{"type":"text","value":" method, which maps predictions back to the original coordinate space for evaluation and visualization.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"yDcC1wvMV1"}],"key":"l0eFbg20M8"}],"key":"yKN0YPIm2f"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"class NormalizeTargetsWrapper(torch.utils.data.Dataset):\n    \"\"\"\n    Wraps a PyG dataset to normalize `y` from [min_val, max_val] ‚Üí [-1, 1].\n    \"\"\"\n    def __init__(self, dataset, min_val, max_val):\n        self.dataset = dataset\n        self.min_val = min_val\n        self.max_val = max_val\n\n    def __len__(self):\n        return len(self.dataset)\n\n    def __getitem__(self, idx):\n        data = self.dataset[idx].clone()\n        # scale from [min, max] to [-1, 1]\n        data.y = 2 * (data.y - self.min_val) / (self.max_val - self.min_val) - 1\n        return data\n\n    def denormalize(self, norm_y):\n        # scale back from [-1, 1] to [min, max]\n        return 0.5 * (norm_y + 1) * (self.max_val - self.min_val) + self.min_val","key":"U4AUanCNTW"},{"type":"outputs","id":"1zUr_bI6vQpWyNtvpBUrE","children":[],"key":"AmvbEsr5Us"}],"key":"yIOJMo2q12"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"normalized_dataset = NormalizeTargetsWrapper(raw_dataset, min_val=0, max_val=6)","key":"bNLKfaM3oZ"},{"type":"outputs","id":"fAJj8GJME0576DPFy-dvm","children":[],"key":"lh5JGENQmt"}],"key":"xknNSPEfPI"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Train/Validation/Test Split and Batching","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RfBnkV2Og0"}],"identifier":"train-validation-test-split-and-batching","label":"Train/Validation/Test Split and Batching","html_id":"train-validation-test-split-and-batching","implicit":true,"key":"GTvrfrRpqi"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We split the dataset into three parts:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"SFiXhipiqc"}],"key":"qhf80nH9lb"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"50%","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"keOlOJI5kH"}],"key":"fWMzNrMdzI"},{"type":"text","value":" for training","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"OAhN9IIRd1"}],"key":"T8uYBDb6ji"}],"key":"EKfNuQXv2q"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"40%","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"tI2hcnM5Wx"}],"key":"RfQxgVuRFL"},{"type":"text","value":" of the remaining for validation","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"f8lstfNeAe"}],"key":"krNgNsHiOB"}],"key":"fIILGmkUY7"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"10%","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"R7c8zyCM8P"}],"key":"ZqpWYKNbld"},{"type":"text","value":" for testing","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"MRwoYv4uNC"}],"key":"d1jyedFJ8o"}],"key":"VNT6sfnqrx"}],"key":"XyBI9UFbZB"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Using ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"VpkcIKi3JI"},{"type":"inlineCode","value":"torch_geometric.loader.DataLoader","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"YAhpSiidQV"},{"type":"text","value":", we then batch graphs together for efficient training.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"JRj44pmdiS"}],"key":"GjUEqpocOX"},{"type":"heading","depth":4,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"üß± How batching works in PyTorch Geometric:","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"idhTGiApcG"}],"identifier":"id-how-batching-works-in-pytorch-geometric","label":"üß± How batching works in PyTorch Geometric:","html_id":"id-how-batching-works-in-pytorch-geometric","implicit":true,"key":"bL8lXtbbUm"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Unlike image datasets, where each batch is a simple tensor stack, in ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"SjhgtDvbKL"},{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"PyG","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"Pp39fIRP66"}],"key":"az5SNyAqnu"},{"type":"text","value":", batching involves:","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"RJA2xrtRBX"}],"key":"mm0kFzCvOX"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":12,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Merging node and edge attributes from multiple graphs","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"VpJwKeY87k"}],"key":"xP8gHhJbNl"}],"key":"Zjkq09C6yF"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Tracking which nodes belong to which graph using a ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"W2i6NX3Lqo"},{"type":"inlineCode","value":"batch","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"LKu9xAfjpV"},{"type":"text","value":" vector","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"DF4bQ8d0xj"}],"key":"vpYh4OXWaq"}],"key":"O0JzH85hPM"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Allowing global pooling operations like ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"xTqEZSNaJ9"},{"type":"inlineCode","value":"GlobalAttention","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"KmoML0pGhg"},{"type":"text","value":" to work on per-graph basis","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"YplgPpVED4"}],"key":"oZFkxBhqZK"}],"key":"AppU2zhfT7"}],"key":"eqqpa7smSX"},{"type":"paragraph","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Each batch now behaves like a single big disconnected graph, where GNN layers operate seamlessly across all examples.","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"A06Ypql42e"}],"key":"gP4i4vYzUB"},{"type":"paragraph","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"We set ","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"G4rmIGsRCY"},{"type":"inlineCode","value":"batch_size=64","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"Vnr8CujJr0"},{"type":"text","value":" for all splits and enable shuffling only for training.","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"tikvoIdVch"}],"key":"ki9zLoPmHD"}],"key":"lR3r8D5X3t"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from torch_geometric.loader import DataLoader\nfrom sklearn.model_selection import train_test_split\n\ntrain_dataset, val_dataset = train_test_split(normalized_dataset, train_size=0.5, random_state=42)\nval_dataset, test_dataset = train_test_split(val_dataset, train_size=0.8, random_state=42)\n\ntrain_loader = DataLoader(train_dataset, batch_size=64, shuffle=True)\nval_loader = DataLoader(val_dataset, batch_size=64, shuffle=False)\ntest_loader = DataLoader(test_dataset, batch_size=64, shuffle=False)\n\n\nprint(f\"nb graph train ds= {len(train_dataset)}, nb graph val ds= {len(val_dataset)}, nb graph test ds= {len(test_dataset)}\")","key":"MkbjfyJ78Z"},{"type":"outputs","id":"0wp-VTTqBY-Qpr3fszf2n","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"nb graph train ds= 500, nb graph val ds= 400, nb graph test ds= 100\n"},"children":[],"key":"ZdKbrazGBd"}],"key":"rzp1TKaVGB"}],"key":"otJRegmTcw"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"üß† GNN Model Definition: MLPNet","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dlJoKSyE5v"}],"identifier":"id-gnn-model-definition-mlpnet","label":"üß† GNN Model Definition: MLPNet","html_id":"id-gnn-model-definition-mlpnet","implicit":true,"key":"XDa0S5aOaA"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We now define our ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dkaM0pFyWG"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"graph neural network","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"MjuePAn1l3"}],"key":"iM3XxlTPwM"},{"type":"text","value":" model, ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Ai7PEKiirQ"},{"type":"inlineCode","value":"MLPNet","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NA5cgKYUWw"},{"type":"text","value":", which predicts the origin coordinates of a seismic event from the structure and signals of a graph.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wa01iXk4UP"}],"key":"OXa0Z2XcQw"},{"type":"heading","depth":3,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"üèóÔ∏è Architecture Overview:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"S61D16af2A"}],"identifier":"id-architecture-overview","label":"üèóÔ∏è Architecture Overview:","html_id":"id-architecture-overview","implicit":true,"key":"fd4utajzFS"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Input Features","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"jApJPyYTZg"}],"key":"N5S7r6eldG"},{"type":"text","value":":","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"xDh3u7miZy"},{"type":"break","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"mJR4avL5Th"},{"type":"text","value":"We concatenate each node‚Äôs 2D position with its signal vector.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"jZPVbos1nO"}],"key":"c0UYT4ByTM"}],"key":"ESnnxKkM1p"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"strong","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"MLP Encoder (","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"ZCt8Ad023z"},{"type":"inlineCode","value":"mlp_in","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"qaXmlQpc1a"},{"type":"text","value":")","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"ofScgvjKLL"}],"key":"dhsP61sSaU"},{"type":"text","value":":","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"t8zRIbVdXK"},{"type":"break","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"BAdVZODbhI"},{"type":"text","value":"A multi-layer perceptron (MLP) maps the concatenated input to a hidden representation.","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"Gul8Fb0Gh0"}],"key":"mJs9kcpbPh"}],"key":"rC2bkQos0a"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"strong","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Graph Attention Layers (","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"J332xlJ4D0"},{"type":"inlineCode","value":"conv1","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"wBX0FfRzPr"},{"type":"text","value":", ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"BMzYDVvrYu"},{"type":"inlineCode","value":"conv2","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"LP6AyXtdNP"},{"type":"text","value":")","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"b9GR0qgdDp"}],"key":"jLeAeC09aO"},{"type":"text","value":":","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"a5adzSdyVb"},{"type":"break","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"kAvxDrcJqS"},{"type":"text","value":"Two ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"ZwlOEmiUre"},{"type":"inlineCode","value":"GATv2Conv","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"ECLHU8l3a7"},{"type":"text","value":" layers apply self-attention across neighboring nodes, using edge weights (inversely proportional to distance).","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"XmuYCLiYCx"}],"key":"C9xDFzOawX"},{"type":"blockquote","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"üîÅ ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"hWO88o8aq4"},{"type":"emphasis","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Note:","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"aZz5WMERzq"}],"key":"V7rLqDjCPp"},{"type":"text","value":" Only ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"eHAcWFrBns"},{"type":"inlineCode","value":"conv1","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"xZPQ4C5IU0"},{"type":"text","value":" is used here; ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"QKJertBmiS"},{"type":"inlineCode","value":"conv2","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"aa3poIy4U6"},{"type":"text","value":" is commented out, for model simplification, but showing the possibility to extend the number of message passing layers.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"uZ8MUvLBFr"}],"key":"hlqgwRypad"}],"key":"LiHkkm0b0P"}],"key":"UM6b2d7hy2"},{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"strong","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"MLP Decoder (","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"qXvD9TXIE3"},{"type":"inlineCode","value":"mlp_out","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"GNWv50FcyO"},{"type":"text","value":")","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"pdDDpMmsVC"}],"key":"c85oGj4BRP"},{"type":"text","value":":","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"NE1cBxkT1L"},{"type":"break","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"xK07K6DeqM"},{"type":"text","value":"Another MLP refines node embeddings after message passing.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"Z72teiGArM"}],"key":"uely3TVOb9"}],"key":"Dv3beMAxIW"},{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":20,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"strong","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"Global Attention Pooling (","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"sTBDNbhfOM"},{"type":"inlineCode","value":"att_pool","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"yKsGIYe4r3"},{"type":"text","value":")","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"KAfVYzaczI"}],"key":"E9VrQCsy9j"},{"type":"text","value":":","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"aNjRRG6Y7J"},{"type":"break","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"FjTVNZYfMh"},{"type":"text","value":"Aggregates node features into a single graph-level vector using learnable attention weights (via ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"nCZccnhz46"},{"type":"inlineCode","value":"GlobalAttention","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"bZw8GGYY24"},{"type":"text","value":").","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"fqMuOKaXjB"}],"key":"LGEdYjZeYL"}],"key":"BHYjtunW6H"},{"type":"listItem","spread":true,"position":{"start":{"line":23,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"strong","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"Final Linear Output (","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"ruUNlqRMZa"},{"type":"inlineCode","value":"out_linear","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"GGDvFTxH90"},{"type":"text","value":")","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"IHg29nDFtp"}],"key":"z3Rk5OlvJH"},{"type":"text","value":":","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"ikqRG6vjIl"},{"type":"break","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"npFCiqqu2J"},{"type":"text","value":"Predicts a 2D coordinate from the pooled graph representation, constrained to ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"bEnawuo18P"},{"type":"strong","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"[-1, 1]","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"e1X6iuZtci"}],"key":"tjxtf9s5QL"},{"type":"text","value":" via ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"iYRLfqQEdI"},{"type":"inlineCode","value":"tanh()","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"VM6oF1pZ0y"},{"type":"text","value":".","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"RSmq3r0rOl"}],"key":"R3ljXg8UMP"}],"key":"X4sKNBm4rR"}],"key":"Osx4zmJ3cH"},{"type":"heading","depth":3,"position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"üì§ Output:","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"kdEK1pFIjF"}],"identifier":"id-output","label":"üì§ Output:","html_id":"id-output","implicit":true,"key":"VROgrwNPcz"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":27,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":27,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"A single 2D coordinate per graph, representing the model‚Äôs ","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"A5EZsKgk0G"},{"type":"strong","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"normalized prediction of the origin","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"kYeMwHxhd3"}],"key":"G86iNIObBd"},{"type":"text","value":".","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"stb98Agk4S"}],"key":"uLmdMZgD5n"}],"key":"I8IG3NjudZ"}],"key":"qAuiMpFzoD"},{"type":"paragraph","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"This architecture combines local (node-level) feature transformations with global (graph-level) aggregation, making it well-suited for spatial inference tasks like epicenter localization.","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"SUR6oyN1Bg"}],"key":"LQhKDZhEqu"}],"key":"mounShVbh1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"class MLPNet(torch.nn.Module):\n    \"\"\"\n    GNN model with MLP ‚Üí 2x GATv2Conv ‚Üí MLP for graph-level origin prediction.\n\n    Args:\n        channels_x (int): Positional input features per node.\n        channels_y (int): Signal features per node.\n        hidden_channels (int): Hidden dimension.\n        dropout (float): Dropout probability.\n        self_loops (bool): Whether to add self-loops to GATv2Conv.\n\n    Output:\n        Tensor of shape (batch_size, 2), normalized origin coordinates (in [-1, 1]).\n    \"\"\"\n    def __init__(self, channels_x, channels_y, hidden_channels=128, dropout=0.3, self_loops=True):\n        super(MLPNet, self).__init__()\n        torch.manual_seed(1234)\n\n        self.mlp_in = MLP([channels_x + channels_y, 64, hidden_channels])\n\n        self.conv1 = GATv2Conv(\n            in_channels=hidden_channels,\n            out_channels=hidden_channels,\n            heads=2,\n            edge_dim=1,\n            add_self_loops=self_loops,\n            concat=True\n        )\n\n        self.conv2 = GATv2Conv(\n            in_channels=hidden_channels * 2,  # output of conv1 with 2 heads\n            out_channels=hidden_channels,\n            heads=2,\n            edge_dim=1,\n            add_self_loops=self_loops,\n            concat=True\n        )\n\n        self.mlp_out = MLP([hidden_channels * 2, 64], act=nn.LeakyReLU(), dropout=dropout)\n\n        self.att_pool = GlobalAttention(\n            gate_nn=torch.nn.Sequential(\n                nn.Linear(64, 32),\n                nn.ReLU(),\n                nn.Linear(32, 1)\n            )\n        )\n\n        self.out_linear = Linear(64, 2)\n        \n    def forward(self, pos, signal, edge_index, edge_weight, batch=None):\n        x = torch.cat([pos, signal], dim=-1)\n        x = self.mlp_in(x)\n        x = self.conv1(x, edge_index, edge_weight)\n        # x = self.conv2(x, edge_index, edge_weight)\n        x = self.mlp_out(x)\n\n        if batch is None:\n            batch = torch.zeros(x.size(0), dtype=torch.long, device=x.device)\n\n        graph_repr = self.att_pool(x, batch)\n        return self.out_linear(graph_repr).tanh()","key":"SViIDMeTtw"},{"type":"outputs","id":"fZA0OuQsC9nww1Jj6A9q8","children":[],"key":"bFVyX9ZgvV"}],"key":"yKXH6OI8df"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"üöÄ Training Loop","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fhY1v4DzIC"}],"identifier":"id-training-loop","label":"üöÄ Training Loop","html_id":"id-training-loop","implicit":true,"key":"PqUVRqtxkR"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This section defines the training and validation routines for our GNN model, as well as a simple early stopping mechanism.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JSx9z2UahH"}],"key":"D5f8IsFAm7"}],"key":"O5uwvonUpQ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"üõ†Ô∏è Helper Functions","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vPQHNYCjAe"}],"identifier":"id-helper-functions","label":"üõ†Ô∏è Helper Functions","html_id":"id-helper-functions","implicit":true,"key":"j9nagOqq75"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Before starting the main loop, we define:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dnvzHmxsgO"}],"key":"s713FOWWDR"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"inlineCode","value":"EarlyStopper","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"mbW1pMzbMN"}],"key":"jsWI9Bwpul"},{"type":"break","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"wPwtU9BBUF"},{"type":"text","value":"A utility class to stop training when the validation loss plateaus. It tracks the lowest validation loss seen and stops training if no improvement is observed for a specified number of epochs (","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"bbJ6N31Isg"},{"type":"inlineCode","value":"patience","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"XklBLk5Shc"},{"type":"text","value":").","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"DpwuJszAeU"}],"key":"cXuyJQWwwY"}],"key":"R1DyJbu7dd"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"inlineCode","value":"train()","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"esjyeYMlIv"}],"key":"EtitVQFlcS"},{"type":"break","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"P1MJcA1siI"},{"type":"text","value":"Runs one full training epoch:","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"DQYxJJVAfC"}],"key":"HQEPkHhR7D"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":10,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Iterates over batched graphs","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"sqhJ7Akc2u"}],"key":"EK6qiciop0"}],"key":"qTSmR2h85M"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Computes predictions and loss","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"uOj5tv57PT"}],"key":"uNDF6KBJgU"}],"key":"vHDEyZ1jD6"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Updates model weights using backpropagation","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"RJysmNuSAO"}],"key":"Gknw1DJlhW"}],"key":"K1mrgOysd7"}],"key":"us5Ht0UeJQ"}],"key":"z5UPnKYkR6"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"strong","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"inlineCode","value":"validation()","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"gdxwJ2hObD"}],"key":"NKPOojhm5b"},{"type":"break","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"tVL5XDnt48"},{"type":"text","value":"Evaluates the model on a validation set without updating weights. This is used to monitor overfitting and trigger early stopping.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"gp6jxM1nDa"}],"key":"sc9LEh2o9L"}],"key":"WxtLRZSLgZ"}],"key":"gKRpyxCOPI"},{"type":"blockquote","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"‚ÑπÔ∏è Both ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"UkYZKGE7xg"},{"type":"inlineCode","value":"train()","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"ebMcDsLHAw"},{"type":"text","value":" and ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"GFx22dOiT2"},{"type":"inlineCode","value":"validation()","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"IgccSN8fou"},{"type":"text","value":" rely on:","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"eaGr2pAkdP"}],"key":"pc4weqBjXp"}],"key":"mfV8Sq9RVm"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":18,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The global ","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"vBwhq9MJyy"},{"type":"inlineCode","value":"model","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"KMCruUTdh0"},{"type":"text","value":", ","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"m1FoDoWM2i"},{"type":"inlineCode","value":"optimizer","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"Z1HE7urfH7"},{"type":"text","value":", and ","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"NLhex5tl9Y"},{"type":"inlineCode","value":"criterion","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"q6ybC9Ud3Z"}],"key":"tVuFtzZCD8"}],"key":"VPkbKPhgNa"},{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Batched data from ","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"QPAtYeURZP"},{"type":"inlineCode","value":"torch_geometric.loader.DataLoader","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"xJv6CleiXK"}],"key":"kRfU7I4OXp"}],"key":"ykmmNsRgLz"},{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":".to(device)","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"PVi4bVWhCs"},{"type":"text","value":" to move data to the appropriate compute device (e.g., GPU)","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"wkpcdPTMtD"}],"key":"b2N9aDjLIT"}],"key":"Vxz7PxFPXH"}],"key":"OqdbWkMiUT"}],"key":"vT82gY5GoH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"class EarlyStopper:\n    \"\"\"\n    A class for early stopping the training process when the validation loss stops improving.\n    \"\"\"\n    def __init__(self, patience=1, min_delta=0):\n        self.patience = patience\n        self.min_delta = min_delta\n        self.counter = 0\n        self.min_validation_loss = np.inf\n\n    def early_stop(self, validation_loss):\n        if validation_loss < self.min_validation_loss:\n            self.min_validation_loss = validation_loss\n            self.counter = 0\n        elif validation_loss > (self.min_validation_loss + self.min_delta):\n            self.counter += 1\n            if self.counter >= self.patience:\n                return True\n        return False\n\n\ndef train(dataloader, device):\n    model.train()\n    mean_loss = 0\n    for data in dataloader:\n        data = data.to(device)\n        optimizer.zero_grad()\n\n        # Forward pass\n        pred = model(data.pos, data.signal, data.edge_index, data.edge_weight, data.batch)  # ‚Üí shape [num_graphs, 2]\n\n        # Check shape of target\n        assert data.y.shape == pred.shape, f\"Expected y shape {pred.shape}, got {data.y.shape}\"\n\n        loss = criterion(pred, data.y)\n        loss.backward()\n        optimizer.step()\n        mean_loss += loss.item()\n    return mean_loss / len(dataloader)\n\n\n@torch.no_grad()\ndef validation(dataloader, device):\n    model.eval()\n    total_loss = 0\n    for data in dataloader:\n        data = data.to(device)\n        pred = model(data.pos, data.signal, data.edge_index, data.edge_weight, data.batch)\n        loss = criterion(pred, data.y)\n        total_loss += loss.item()\n    return total_loss / len(dataloader)","key":"B1HiAMu3Ki"},{"type":"outputs","id":"dLdV_N9i6Uec0aZnhW48v","children":[],"key":"WXn6uq88te"}],"key":"cmBIiKpWWe"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"‚öôÔ∏è Training Setup","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ltUuD3zPvw"}],"identifier":"id-training-setup","label":"‚öôÔ∏è Training Setup","html_id":"id-training-setup","implicit":true,"key":"jrLPSsocPT"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Before launching training:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"WzLDWtjewC"}],"key":"FWmlbfKZNH"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"We select a compute device (GPU if available).","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"upYhAZ8ib5"}],"key":"YaTuQyY1tc"}],"key":"xYDC1uyQjz"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Instantiate the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"TWzgVU28BM"},{"type":"inlineCode","value":"MLPNet","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"i64j1tjokv"},{"type":"text","value":" model.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"XlVtH26xXv"}],"key":"Lu9KcXsLlb"}],"key":"goKMVyZEoo"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Use ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"xzh60FFp30"},{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Mean Squared Error (MSE)","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"e8B0cnTwaS"}],"key":"qfxWeMvQaR"},{"type":"text","value":" as the loss function ‚Äî ideal for continuous coordinate regression.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"iosoysEQ3c"}],"key":"Q0byf5AryZ"}],"key":"p3YtUHncdE"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Choose the ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"f8HTwXYXkW"},{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Adam optimizer","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"gJt7xvnNHq"}],"key":"wMK19cQ6Y3"},{"type":"text","value":" with a learning rate of ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"znTawK5r2y"},{"type":"inlineCode","value":"1e-4","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"uZocQzpkIX"},{"type":"text","value":".","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"dgoahHHceH"}],"key":"pyylWDxUXi"}],"key":"UY5TMIeuQQ"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Initialize the ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"Xntn9cJn50"},{"type":"inlineCode","value":"EarlyStopper","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"cdFGXCV9xJ"},{"type":"text","value":" to monitor validation loss and prevent overfitting.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"CdEsSpfdWP"}],"key":"Vs2cPmGDCZ"}],"key":"NLfRz7wXN3"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Set up a checkpointing path to save the best model based on validation performance.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Zbyzpgc4ex"}],"key":"Lu5csKYD4t"}],"key":"kHPc4zHY8b"}],"key":"VUGoVglD9t"}],"key":"MHnzxN0chV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"device = torch.device('cuda:0' if torch.cuda.is_available() else 'cpu')\n\nmodel = MLPNet(data.pos.shape[1], data.signal.shape[1], hidden_channels=64)\n\ncriterion = torch.nn.MSELoss()  # Define loss criterion.\noptimizer = torch.optim.Adam(model.parameters(), lr=0.0001)  # Define optimizer.\nearly_stopper = EarlyStopper(patience=1, min_delta=0.0)\nloss_train = []\nloss_val = []\nbest_loss = 1\nbest_epoch = 0\nPATH_CHECKPOINT = \"./checkpoint/best_origin_pred.pt\"\n# Create the folder if it doesn't exist\nos.makedirs(os.path.dirname(PATH_CHECKPOINT), exist_ok=True)\nmodel","key":"Z2tBKWRsgj"},{"type":"outputs","id":"lywxuNNEvSkVngyIlf-R7","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/srv/conda/envs/notebook/lib/python3.12/site-packages/torch_geometric/deprecation.py:26: UserWarning: 'nn.glob.GlobalAttention' is deprecated, use 'nn.aggr.AttentionalAggregation' instead\n  warnings.warn(out)\n"},"children":[],"key":"VyvlQiEZ0j"},{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":16,"metadata":{},"data":{"text/plain":{"content":"MLPNet(\n  (mlp_in): MLP(22, 64, 64)\n  (conv1): GATv2Conv(64, 64, heads=2)\n  (conv2): GATv2Conv(128, 64, heads=2)\n  (mlp_out): MLP(128, 64)\n  (att_pool): GlobalAttention(gate_nn=Sequential(\n    (0): Linear(in_features=64, out_features=32, bias=True)\n    (1): ReLU()\n    (2): Linear(in_features=32, out_features=1, bias=True)\n  ), nn=None)\n  (out_linear): Linear(in_features=64, out_features=2, bias=True)\n)","content_type":"text/plain"}}},"children":[],"key":"Rn8VNwRnnS"}],"key":"qpQYwEfeZU"}],"key":"TkwXdBUo8d"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"üîÅ Training Loop","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hpNv4KJC0f"}],"identifier":"id-training-loop","label":"üîÅ Training Loop","html_id":"id-training-loop-1","implicit":true,"key":"c2iwTfggNo"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The loop runs for up to ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"uAKYc3gDlD"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"5000 epochs","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"B8KYfV0bUs"}],"key":"nD8wiQo0a4"},{"type":"text","value":", or until early stopping is triggered. At each epoch:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BwRAqVuOuw"}],"key":"CFtfiz59Zu"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"We compute and store the training and validation losses.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"fyrbSELMGM"}],"key":"BssRxkXD3c"}],"key":"V3bi07UgEb"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Save the model whenever a new best validation loss is observed.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"WMx4a4gR5W"}],"key":"NAAuNEfdvx"}],"key":"WI1eYYnlnQ"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Use ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"cEOcY1vWyF"},{"type":"inlineCode","value":"tqdm","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"OSqa2JfJtZ"},{"type":"text","value":" to display a real-time progress bar with current losses.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"tKo8W0Tpo8"}],"key":"fomypORDZF"}],"key":"uN8SbCIBHo"}],"key":"c3XeFumTPf"},{"type":"blockquote","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"üß† Note: Early stopping helps avoid unnecessary training once the model stops improving.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"ffqJK5R4Up"}],"key":"ZkEL7XyKw9"}],"key":"GuKdRgqqd5"}],"key":"bGlg9gANc9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"start_time = time.perf_counter()\nnb_epoch = tqdm(range(5000))\n\nfor epoch in nb_epoch:\n    loss_train.append(train(train_loader, device))\n    loss_val.append(validation(val_loader, device))\n    \n    if loss_val[-1] < best_loss:\n        best_loss = loss_val[-1]\n        best_epoch = epoch\n        torch.save(model.state_dict(), PATH_CHECKPOINT)\n    if early_stopper.early_stop(loss_val[-1]):\n        print(f\"early stopping at epoch {epoch}: train loss={loss_train[-1]}, val loss={loss_val[-1]}\")\n        break\n    nb_epoch.set_postfix_str(f\"train loss={loss_train[-1]}, val loss={loss_val[-1]}\")","key":"VW30g7LmC6"},{"type":"outputs","id":"TkAD1qOMCl9XW5zhXStTm","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"  1%|          | 59/5000 [00:12<17:40,  4.66it/s, train loss=0.06399355875328183, val loss=0.07068957335182599]"},"children":[],"key":"p5dbrpOl17"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"early stopping at epoch 59: train loss=0.0641244943253696, val loss=0.07113602384924889\n"},"children":[],"key":"KehqLIVjrW"},{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"\n"},"children":[],"key":"VlAE5iMioi"}],"key":"Jp2TiIxsxa"}],"key":"lACARN5bJw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.plot(loss_train, label=\"Train\")\nplt.plot(loss_val, label = \"Validation\")\nplt.legend(loc='center left', bbox_to_anchor=(1, 0.5))","key":"MwxedD8Pof"},{"type":"outputs","id":"mXEB1ami68t3ydXC5wqzZ","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"bbe8ac8960873d7ee67041d4cba8a2e9","path":"/bbe8ac8960873d7ee67041d4cba8a2e9.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"Hm5AtqXibv"}],"key":"izkYhMi9Rr"}],"key":"kYwgniTh3R"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"üìà Model Evaluation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Z8utWNBwKb"}],"identifier":"id-model-evaluation","label":"üìà Model Evaluation","html_id":"id-model-evaluation","implicit":true,"key":"sZuSzPEFrX"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"After training, we assess how well the model generalizes to unseen data.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vHetcNE01w"}],"key":"sRMmz9R5CZ"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The evaluation process includes:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"aq3mD9Yp88"}],"key":"xRxqIXOvsn"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Load Best Model Checkpoint","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"HP28MqEErN"}],"key":"FI4zPyuypR"},{"type":"break","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"pCk70FpKOO"},{"type":"text","value":"We reload the model weights corresponding to the best validation loss during training. This ensures that we evaluate the most performant version of the model, not just the final state.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"E3efguUzac"}],"key":"HXbZSOfPJw"}],"key":"WQ5aMMuHIW"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"strong","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Visual Inspection on a Few Graphs","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"IAGgyK55t7"}],"key":"l7j22p8vLD"},{"type":"break","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"IVd9zowSri"},{"type":"text","value":"We make predictions on a small set of random graphs from the test set.","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"vrgdqeXzP9"}],"key":"Q5g8dfg6HQ"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":12,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Visualize predicted vs true origin positions.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"TTNYj1Imzh"}],"key":"TVm5hACRGa"}],"key":"ZwYqAxyQ4R"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Get an intuitive feel for typical prediction quality.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"VEbHCrTxJm"}],"key":"ewGifFIV7r"}],"key":"S0MFP8X4CW"}],"key":"CX2IqDIYpv"}],"key":"ZDfI8tqxmy"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"strong","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Full Test Set Prediction","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"fE6KDsxZ2I"}],"key":"bDkzlCs2GU"},{"type":"break","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"gG0POsxvci"},{"type":"text","value":"We then predict on the entire test set to quantify performance over a larger sample.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"g7LBGl168K"}],"key":"VbksgBARTI"}],"key":"OERInSRzck"},{"type":"listItem","spread":true,"position":{"start":{"line":18,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":18,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"strong","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Compute Simple Metrics","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"l5yCrCVjHH"}],"key":"bPESjiTA0G"},{"type":"break","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"wJZoyD94AY"},{"type":"text","value":"We calculate basic metrics such as:","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"WZQrfkf98f"}],"key":"ZoaPgj530M"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":20,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"Mean Absolute Error (MAE)","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"eAPxMYMgkg"}],"key":"UdL3KWXEHi"},{"type":"text","value":" between predicted and true coordinates","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"m26WgQvdRh"}],"key":"uZ3RY0iPIQ"}],"key":"RQiZPzslt9"},{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Optionally visualize prediction error distributions","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"elRaD5JJud"}],"key":"EGPoWMlM77"}],"key":"FMPWNRPLrm"}],"key":"OLtzerKij3"}],"key":"DjIhXlqjXY"}],"key":"jO7U27kabw"},{"type":"blockquote","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"üß† This evaluation allows both qualitative (plots) and quantitative (error metrics) understanding of model performance.","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"SgeAkl0C81"}],"key":"VFEtMPcUky"}],"key":"G6mY2Vcs69"}],"key":"HPFO4hvjy3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# restore best model\n# PATH_CHECKPOINT = \"./checkpoint/best_origin_pred.pt\"\nmodel.load_state_dict(torch.load(PATH_CHECKPOINT))\nprint(f\"best loss={best_loss}, model eval loss={validation(test_dataset, device)} at epoch {best_epoch}\")","key":"URvijtlYkf"},{"type":"outputs","id":"6X0d7yCA-tN4JOqG155kO","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"best loss=0.07068957335182599, model eval loss=0.05902902354137041 at epoch 58\n"},"children":[],"key":"Uz1VkrymwB"}],"key":"fKR6rbsNLT"}],"key":"jMU6e09cuc"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"üîç Visualizing Predictions on 9 Test Graphs","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WgqdGwTWyi"}],"identifier":"id-visualizing-predictions-on-9-test-graphs","label":"üîç Visualizing Predictions on 9 Test Graphs","html_id":"id-visualizing-predictions-on-9-test-graphs","implicit":true,"key":"JW0ticnvyr"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"To qualitatively evaluate the model‚Äôs spatial accuracy, we display predictions on 9 test graphs using a 3√ó3 grid.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jY429dlxDa"}],"key":"kuRGBGWbwc"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Each subplot shows:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"e82k9DsaJz"}],"key":"jXWTlTmPCR"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":6,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The graph structure and node positions","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"RwRBEsKZBA"}],"key":"fxxR74IJZ9"}],"key":"BHh1hWJksT"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Node coloring based on signal values","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"OioIKyyBoF"}],"key":"p2Vok3ho9C"}],"key":"gYAIXEki2r"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"OiVKDiIhVs"},{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"true origin","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"QvU8Lx6sfR"}],"key":"xAI6WqRTm8"},{"type":"text","value":" (red ‚ùå) and ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"hY1hp3Az1p"},{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"predicted origin","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"dzuUyOM67h"}],"key":"jwYjk2x7Xc"},{"type":"text","value":" (blue ‚ùå)","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"XA1U5Gtl3o"}],"key":"MvKHcuTuc5"}],"key":"Cj0zqPfWtk"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The per-sample ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"aCeTPBu7sg"},{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Euclidean error","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"gbJz4XDpMp"}],"key":"cyCBw2apb4"},{"type":"text","value":" in the title","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Naq4jrUiTh"}],"key":"LL94CGFxkX"}],"key":"J49oUxSiCO"}],"key":"f4z72tEiCj"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"This visualization helps identify both successful and challenging prediction scenarios.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"Y3YBuJLuro"}],"key":"gnhSyW67Rf"}],"key":"S0ZONB9JF1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig, axs = plt.subplots(3, 3, figsize=(15, 15))\naxs = axs.flatten()\n\nfor i in range(9):\n    data = test_dataset[i].clone().to(device)\n\n    with torch.no_grad():\n        pred = model(data.pos, data.signal, data.edge_index, data.edge_weight, batch=None)\n\n    data.pred = normalized_dataset.denormalize(pred)\n    data.y = normalized_dataset.denormalize(data.y)\n    data.error = torch.norm(data.pred - data.y, dim=-1).unsqueeze(0)\n\n    ax = axs[i]\n    # Custom version of visualize_graph_torch that plots into a given `ax`\n    visualize_graph_torch(data, color=\"signal\", pred=True, ax=ax)\n    ax.set_title(f\"Sample {i} | Error: {data.error.item():.2f}\")\n\nplt.tight_layout()\nplt.show()","key":"oyhLCVRkXy"},{"type":"outputs","id":"ReIqIRz3x-hjndLZYPXFc","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"58243d75177ac3db0c8aa3778decd561","path":"/58243d75177ac3db0c8aa3778decd561.png"},"text/plain":{"content":"<Figure size 1500x1500 with 9 Axes>","content_type":"text/plain"}}},"children":[],"key":"cI1HFPI4WE"}],"key":"K9fK8ucH3P"}],"key":"Bp8qkfvGl5"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"üìä Quantitative Evaluation and Error Distribution","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Qr96jKidQc"}],"identifier":"id-quantitative-evaluation-and-error-distribution","label":"üìä Quantitative Evaluation and Error Distribution","html_id":"id-quantitative-evaluation-and-error-distribution","implicit":true,"key":"p64tvUEjgk"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We compute a set of quantitative metrics over the full test set to assess the model‚Äôs predictive accuracy.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LFpXTt0Pl2"}],"key":"w3UjgEGzbb"},{"type":"heading","depth":4,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"üßÆ Reported Metrics:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"W5XuQKwpQL"}],"identifier":"id-reported-metrics","label":"üßÆ Reported Metrics:","html_id":"id-reported-metrics","implicit":true,"key":"twgHTTajUe"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":6,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"MAE (Mean Absolute Error)","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Fqqk2ErKmx"}],"key":"NBoPJtFObz"},{"type":"text","value":" for X and Y separately","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"y50Ee8sZdX"}],"key":"TNogPQv2QY"}],"key":"cIhzAe8Jo1"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Total MAE","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"GG3ZghSXx7"}],"key":"PWi9ZP9oXK"},{"type":"text","value":" across both dimensions","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"cM0Di8vsui"}],"key":"sVuiiAMDoc"}],"key":"u6U4vEslLc"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"RMSE (Root Mean Squared Error)","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"MCbIBgnVuJ"}],"key":"j27zX7R0IP"},{"type":"text","value":" ‚Äî penalizes larger errors more heavily","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"gkQUp6HEmh"}],"key":"MbB7r07hxS"}],"key":"bR7AIdZnz6"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Mean Euclidean Error","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"d9HQVfPGzU"}],"key":"DkD58uqZBj"},{"type":"text","value":" ‚Äî distance between predicted and true origin","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"HywzaVx3xk"}],"key":"FrRydxMXAu"}],"key":"AG6hu08ddD"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Max Euclidean Error","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"AOCR4fde45"}],"key":"rFh6CyoaxD"},{"type":"text","value":" ‚Äî worst-case prediction","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"F6grjEOBJK"}],"key":"Te27kUNhkg"}],"key":"U9dCJ6SpxJ"}],"key":"URMj7eH97E"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"These metrics provide a robust summary of how well the model generalizes.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"cEPLlJ2dO3"}],"key":"aoULsPeRT7"},{"type":"heading","depth":4,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"üìâ Error Histogram:","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"qt0U2mYeoN"}],"identifier":"id-error-histogram","label":"üìâ Error Histogram:","html_id":"id-error-histogram","implicit":true,"key":"Ct1TpTdVPY"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"We also visualize the distribution of Euclidean errors across all test samples.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"yERCUxH5e5"}],"key":"IX8LnFKO8D"},{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"A red dashed line shows the ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"GOjksp8ylI"},{"type":"strong","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"expected error from a random guess","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"y7XCxKO0d7"}],"key":"akqux6ashk"},{"type":"text","value":", providing a baseline reference.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"RWNMOSpYbe"},{"type":"break","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"QioqHyXnhy"},{"type":"text","value":"The histogram reveals whether the model consistently predicts near the true origin ‚Äî or struggles in specific regions.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"Pdr1gT19hd"}],"key":"kqd7KXlZvq"}],"key":"wM8IN7vega"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"@torch.no_grad()\ndef evaluate(model, test_loader, normalized_dataset, device):\n    \"\"\"\n    Evaluate model on the full test set and compute error metrics.\n\n    Returns:\n        Dict of evaluation metrics\n    \"\"\"\n    model.eval()\n\n    pred_all = []\n    true_all = []\n\n    for data in test_loader:\n        data = data.to(device)\n        pred = model(data.pos, data.signal, data.edge_index, data.edge_weight, data.batch)\n\n        pred_denorm = normalized_dataset.denormalize(pred)\n        true_denorm = normalized_dataset.denormalize(data.y)\n\n        pred_all.append(pred_denorm.cpu())\n        true_all.append(true_denorm.cpu())\n\n    pred_all = torch.cat(pred_all, dim=0)\n    true_all = torch.cat(true_all, dim=0)\n\n    abs_errors = torch.abs(pred_all - true_all)\n    euclidean_errors = torch.norm(pred_all - true_all, dim=1)\n\n    metrics = {\n        \"MAE_x\": abs_errors[:, 0].mean().item(),\n        \"MAE_y\": abs_errors[:, 1].mean().item(),\n        \"MAE_total\": abs_errors.mean().item(),\n        \"RMSE\": torch.sqrt(((pred_all - true_all) ** 2).mean()).item(),\n        \"Mean Euclidean Error\": euclidean_errors.mean().item(),\n        \"Max Euclidean Error\": euclidean_errors.max().item()\n    }\n\n    for k, v in metrics.items():\n        print(f\"{k}: {v:.3f}\")\n\n    return metrics, pred_all, true_all\n\ndef plot_error_histogram(pred_all, true_all, bounds=(0, 6), bins=30):\n    \"\"\"\n    Plot a histogram of Euclidean errors with optional random baseline.\n\n    Args:\n        pred_all (Tensor): shape [N, 2], model predictions (denormalized)\n        true_all (Tensor): shape [N, 2], true targets (denormalized)\n        bounds (tuple): min/max coordinate bounds for random baseline\n        bins (int): histogram bin count\n    \"\"\"\n    # Compute Euclidean errors\n    errors = torch.norm(pred_all - true_all, dim=1).numpy()\n\n    # Estimate expected error from random predictions in the same domain\n    num_samples = len(pred_all)\n    rand_preds = torch.rand_like(pred_all) * (bounds[1] - bounds[0]) + bounds[0]\n    rand_errors = torch.norm(rand_preds - true_all, dim=1).numpy()\n    expected_random_error = rand_errors.mean()\n\n    # Plot\n    plt.figure(figsize=(8, 5))\n    plt.hist(errors, bins=bins, alpha=0.7, label=\"Model Prediction Error\")\n    plt.axvline(expected_random_error, color=\"red\", linestyle=\"--\", linewidth=2,\n                label=f\"Random baseline: {expected_random_error:.2f}\")\n    plt.xlabel(\"Euclidean Error\")\n    plt.ylabel(\"Frequency\")\n    plt.title(\"Prediction Error Histogram\")\n    plt.legend()\n    plt.grid(True, linestyle=\"--\", alpha=0.5)\n    plt.tight_layout()\n    plt.show()","key":"bZ0Ug9FTQ7"},{"type":"outputs","id":"xWFdeHRi0oO2yuaE1fKVR","children":[],"key":"PTE5wrriNS"}],"key":"CpXkv1SAgu"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"metrics, pred_all, true_all = evaluate(model, test_loader, normalized_dataset, device)\n\n# reuse prediction and truth tensors\nplot_error_histogram(pred_all, true_all, bounds=(0, 6))","key":"Xwr8ol9N3i"},{"type":"outputs","id":"cxtoDfVp1Bi8QPBULIdJ0","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"MAE_x: 0.562\nMAE_y: 0.614\nMAE_total: 0.588\nRMSE: 0.729\nMean Euclidean Error: 0.926\nMax Euclidean Error: 2.202\n"},"children":[],"key":"RUcrH0fB9h"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"ac19c4a28855f26b4e571f9d363d698f","path":"/ac19c4a28855f26b4e571f9d363d698f.png"},"text/plain":{"content":"<Figure size 800x500 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"wrKhwOTKQq"}],"key":"IARB7i6P46"}],"key":"vYj94UkNm8"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"‚úÖ Conclusion","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"d78gnfhohh"}],"identifier":"id-conclusion","label":"‚úÖ Conclusion","html_id":"id-conclusion","implicit":true,"key":"pRq8H6OTPR"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In this notebook, we built and evaluated a Graph Neural Network (GNN) to predict 2D origin coordinates from synthetic seismic-like signals distributed across a spatial graph.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"v1L43uk9qW"}],"key":"hjOlP4Tcz5"},{"type":"heading","depth":3,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"üß† What We Did:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"QuknSKpagI"}],"identifier":"id-what-we-did","label":"üß† What We Did:","html_id":"id-what-we-did","implicit":true,"key":"sl3thSa9Op"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":6,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Generated a toy dataset of sine signals delayed by distance to a hidden origin.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"rLTERFZG9m"}],"key":"QAdYtupTdy"}],"key":"TDuG2gGmI4"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Encoded both spatial (","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"c7X4bxx5sy"},{"type":"inlineCode","value":"pos","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"wFJ2KClHjG"},{"type":"text","value":") and signal features for each node.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"u276VQIyVB"}],"key":"CAi9xV8kiM"}],"key":"JexaQRL0BD"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Used ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"i7K9Tojh1v"},{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"GATv2Conv","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"asrUfR2aur"}],"key":"dcTz9KYHFS"},{"type":"text","value":" layers and ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"XIPOBYcqRd"},{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Global Attention Pooling","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"O1T1M7iky2"}],"key":"Zxw5W94pLc"},{"type":"text","value":" to learn graph-level representations.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"LmSuHm1XgS"}],"key":"ptcni1tbCA"}],"key":"NOmdi6Ch0O"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Normalized targets for stable training and evaluated with metrics like ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"k0nfLJd0Hj"},{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"MAE","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"vJqAeUTuMl"}],"key":"clgxLj4M11"},{"type":"text","value":" and ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"u88RxAuJWl"},{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"RMSE","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"E6hl8igi6m"}],"key":"XgSTwkmz7l"},{"type":"text","value":".","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"L1RpBLDmD5"}],"key":"gQRRCcoScf"}],"key":"jVkUw3UOZu"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Visualized predictions at both the graph-level and dataset-level.","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"jEKJSeyWpa"}],"key":"Xy1qzp4FcU"}],"key":"BTtymI4zts"}],"key":"c9Y2vCiGaU"},{"type":"heading","depth":3,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"üìä What We Learned:","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"HohMBwDlM4"}],"identifier":"id-what-we-learned","label":"üìä What We Learned:","html_id":"id-what-we-learned","implicit":true,"key":"M1FL1Si9Vp"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":13,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"GNNs can effectively model spatial dependencies and delays in signal propagation.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"x8uNDEUD11"}],"key":"TbRmFXkXB7"}],"key":"cFMckhfyAJ"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Attention-based pooling enables flexible aggregation of node-level features.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"MJzaQi2YnZ"}],"key":"uABfGifkhl"}],"key":"TG4qyvAGrk"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Even in a simplified setting, ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"dr4wSYKZZv"},{"type":"strong","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"errors remain spatially structured","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"W9CAzep0H1"}],"key":"zl4FlzmLvT"},{"type":"text","value":" ‚Äî indicating areas where the model struggles (e.g., sparse graphs or boundary cases).","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"EviiwlHPbI"}],"key":"z3xYuJtLOr"}],"key":"WTJi8AYobU"}],"key":"fNV9arb47E"},{"type":"heading","depth":3,"position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"üß≠ Next Steps:","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"NlOo5P3uJB"}],"identifier":"id-next-steps","label":"üß≠ Next Steps:","html_id":"id-next-steps","implicit":true,"key":"uxhbOd8YoR"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":18,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Try more complex synthetic scenarios: include signal polarity, noise bursts, or multi-event graphs.","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"lcKyrtwiRI"}],"key":"MzjfOwUhmB"}],"key":"s26e2iD2W5"},{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Use real waveform datasets (e.g., from ","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"dzeFuy1GEA"},{"type":"link","url":"https://github.com/seisbench/seisbench","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"SeisBench","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"UCSOtHaxr0"}],"urlSource":"https://github.com/seisbench/seisbench","error":true,"key":"ujEU8EF3G1"},{"type":"text","value":") with station metadata.","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"V46aietszw"}],"key":"XNfLvMq2Eo"}],"key":"w5auAvLtri"},{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Experiment with alternate architectures: ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"oYMz3sOJZl"},{"type":"strong","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"GINConv","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"wrqUIoYA8I"}],"key":"S7RawNaDrN"},{"type":"text","value":", ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"grLKyfdPx9"},{"type":"strong","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"Transformer-based pooling","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"CRhSJ1kCNk"}],"key":"j2oWqgx07M"},{"type":"text","value":", or ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"E7622tPQ5A"},{"type":"strong","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"EdgeConv","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"nOpJjIqHVg"}],"key":"tOQIJLtslN"},{"type":"text","value":".","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"ZBVnsBy5HS"}],"key":"b4CkH8YMIl"}],"key":"pJMYGvqWml"},{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Add uncertainty estimation or confidence bounds to predictions.","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"WF7XkFe5x5"}],"key":"MJ0POWXwpt"}],"key":"pxj2WdsZQu"}],"key":"dde2zWdwAj"},{"type":"blockquote","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"üöÄ GNNs are powerful tools for modeling geospatial and physical systems ‚Äî and this notebook is just a start!","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"xKG2sMvL28"}],"key":"kBUeq7gXT8"}],"key":"Ksfhnxm32A"}],"key":"VDHx31co2C"}],"key":"EEmVmcouGA"},"references":{"cite":{"order":[],"data":{}}}}